(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[369],{77765:function(e,t,r){"use strict";r.r(t),r.d(t,{__N_SSP:function(){return Mr},default:function(){return Br}});var n,o=r(91229),i=r(809),a=r.n(i),s=r(92447),u=r(38347),l=r(45754),c=r(27302),d=r(11163),p=r(67294),f=r(71372),g=r(1424),m=r(76714),b=r(69297),v=r(64121),Z=r(93924),h=r(76896),y=r(46617),x=r(47937),k=r(45680),w=r(6569),O=r(56884),S=r(40980),j=r(94096),I=r(48017),C=r(64115),P=r(35528),E=r(44088),N=r(9345),L=r(336),z=r(96699),D=r(48420),T=r(70058),V=r(83346),A=r(17823),R=r(98238),_=r(38779),M=r(23855),B=r(49151),U=r(29238),Q=r.n(U),q=r(97877),F=r(31929),W=r(4293),J=r(26265),X=r(79416),Y=r(24168),K=r(27011),G=r.n(K),H=r(53002),$=r(86034),ee=r(61279),te=r(26729),re=r(36618),ne=r(84496),oe=r(40123),ie=r(16373),ae=r.n(ie);var se=function(e){return new Promise((function(t,r){var n=new FileReader;n.readAsDataURL(e),n.onloadend=function(){return"string"===typeof n.result?t(n.result):r("invalid type")},n.onerror=function(e){return r(e)}}))};var ue=r(42283),le=r(16941),ce=r(32866),de=r(20026),pe=r(70917);function fe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ge(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?fe(Object(r),!0).forEach((function(t){(0,J.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var me=function(e){var t,r,n,o,i=e.event,l=e.eventQuery,d=e.isVisible,f=e.setIsVisible,g=(0,u.Z)(e,["event","eventQuery","isVisible","setIsVisible"]),m=(0,S.useToast)({position:"top"}),b=(0,p.useState)([{label:"Petit",height:140},{label:"Moyen",height:240},{label:"Grand",height:340}]),Z=b[0],h=(b[1],(0,p.useState)(null!==(t=i.eventBanner)&&void 0!==t&&t.url?"url":"local")),y=h[0],x=h[1],k=(0,p.useState)(null),C=k[0],P=k[1],E=(0,p.useRef)(null),N=(0,ue.cI)({mode:"onChange"}),z=N.register,D=N.control,T=N.handleSubmit,V=N.setError,A=N.errors,R=N.clearErrors,_=N.getValues,M=(N.setValue,N.watch),B=(null===(r=i.eventBanner)||void 0===r?void 0:r.height)||Z[0].height,U=M("height")||B,Q=(0,X.VA)(),F=(0,v.Z)(Q,2),W=F[0],J=F[1],Y=function(){var e=(0,s.Z)(a().mark((function e(t){var r,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("submitted",t),e.prev=1,r={},r="url"===y?{eventBanner:{url:t.url,height:t.height}}:{eventBanner:{height:t.height,mode:t.mode,base64:null===E||void 0===E||null===(n=E.current)||void 0===n?void 0:n.getImageScaledToCanvas().toDataURL()}},e.next=6,W({payload:r,eventUrl:i.eventUrl});case 6:m({title:"L'image de couverture a bien \xe9t\xe9 modifi\xe9e !",status:"success"}),l.refetch(),f(ge(ge({},d),{},{banner:!1})),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),(0,le.S)(e.t0,(function(e){return V("formErrorMessage",{type:"manual",message:e})}));case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}();return(0,pe.tZ)(q.rj,g,(0,pe.tZ)(q.rU,{variant:"no-underline",onClick:function(){return f(ge(ge({},d),{},{banner:!d.banner,logo:!1}))}},(0,pe.tZ)(q.Q1,{borderTopRadius:"lg",borderBottomRadius:d.banner?void 0:"lg",alignItems:"center"},(0,pe.tZ)(j.k,{flexDirection:"row",alignItems:"center"},d.banner?(0,pe.tZ)(w.v,null):(0,pe.tZ)(O.X,null),(0,pe.tZ)(L.X,{size:"sm",py:3},"Changer l'image de couverture")))),d.banner&&(0,pe.tZ)(q.P4,{light:{bg:"orange.100"},dark:{bg:"gray.500"}},(0,pe.tZ)(I.xu,{p:5},(0,pe.tZ)("form",{method:"post",onChange:function(){R("formErrorMessage")},onSubmit:T(Y)},(0,pe.tZ)(ce.B,{errors:A,name:"formErrorMessage",render:function(e){var t=e.message;return(0,pe.tZ)(c.bZ,{status:"error",mb:3},(0,pe.tZ)(c.zM,null),(0,pe.tZ)(q.h1,null,t))}}),(0,pe.tZ)(H.E,{name:"uploadType",mb:3},(0,pe.tZ)($.Kq,{spacing:2},(0,pe.tZ)(ee.Y,{isChecked:"local"===y,onChange:function(){x("local")}},"Envoyer une image depuis votre ordinateur"),(0,pe.tZ)(ee.Y,{isChecked:"url"===y,onChange:function(){x("url")}},"Utiliser une image en provenance d'une autre adresse"))),(0,pe.tZ)(te.NI,{id:"height",mb:3},(0,pe.tZ)(re.l,null,"Hauteur"),(0,pe.tZ)(q.Ph,{name:"height",ref:z(),defaultValue:B},Z.map((function(e){var t=e.label,r=e.height;return(0,pe.tZ)("option",{key:"height-"+r,value:r},t)})))),"url"===y?(0,pe.tZ)(de.I,{name:"url",register:z,control:D,label:"Adresse internet de l'image",defaultValue:null===(n=i.eventBanner)||void 0===n?void 0:n.url,errors:A,isMultiple:!1}):(0,pe.tZ)(p.Fragment,null,(0,pe.tZ)(te.NI,{id:"file",isInvalid:!!A.file,mb:3},(0,pe.tZ)(re.l,null,"Image"),(0,pe.tZ)(q.II,{height:"auto",py:3,name:"file",type:"file",accept:"image/*",onChange:function(){var e=(0,s.Z)(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.target.files||!t.target.files[0]){e.next=8;break}if(!(t.target.files[0].size<1e6)){e.next=8;break}return e.t0=P,e.next=5,se(t.target.files[0]);case 5:e.t1=e.sent,(0,e.t0)(e.t1),R("file");case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ref:z({validate:function(e){return!(e&&e[0]&&e[0].size>=1e6)||"L'image ne doit pas d\xe9passer 1Mo."}})}),(0,pe.tZ)(ne.J,null,(0,pe.tZ)(ce.B,{errors:A,name:"file"})))),(0,pe.tZ)(I.xu,{mb:3},"url"===y?(0,pe.tZ)(oe.E,{src:_("url")||(null===(o=i.eventBanner)||void 0===o?void 0:o.url)}):C&&(0,pe.tZ)(G(),{ref:E,image:C,width:1154,height:parseInt(U),border:0,color:[255,255,255,.6],scale:1,rotate:0})),(0,pe.tZ)(q.zx,{colorScheme:"green",type:"submit",isLoading:J.isLoading,isDisabled:Object.keys(A).length>0},"Valider")))))};function be(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ve(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?be(Object(r),!0).forEach((function(t){(0,J.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):be(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ze=function(e){var t=e.event,r=e.eventQuery,n=e.isVisible,o=e.setIsVisible,i=(0,u.Z)(e,["event","eventQuery","isVisible","setIsVisible"]),l=(0,S.useToast)({position:"top"}),d=(0,X.VA)(),f=(0,v.Z)(d,2),g=f[0],m=f[1],b=(0,ue.cI)({mode:"onChange"}),Z=b.register,h=b.handleSubmit,y=b.setError,x=b.errors,k=b.clearErrors,C=(b.watch,(0,p.useState)()),P=C[0],E=C[1],z=(0,p.useRef)(null),D=function(){var e=(0,s.Z)(a().mark((function e(i){var s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("submitted",i),e.prev=1,e.next=4,g({payload:{eventLogo:{width:220,height:220,base64:null===z||void 0===z||null===(s=z.current)||void 0===s?void 0:s.getImageScaledToCanvas().toDataURL()}},eventUrl:t.eventUrl});case 4:l({title:"Le logo de l'\xe9v\xe9nement a bien \xe9t\xe9 modifi\xe9 !",status:"success"}),r.refetch(),o(ve(ve({},n),{},{logo:!1})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),(0,le.S)(e.t0,(function(e){return y("formErrorMessage",{type:"manual",message:e})}));case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}();return(0,pe.tZ)(N.r,i,(0,pe.tZ)(q.rU,{variant:"no-underline",onClick:function(){return o(ve(ve({},n),{},{logo:!n.logo,banner:!1}))}},(0,pe.tZ)(q.Q1,{borderTopRadius:"lg",borderBottomRadius:n.logo?void 0:"lg",alignItems:"center"},(0,pe.tZ)(j.k,{flexDirection:"row",alignItems:"center"},n.logo?(0,pe.tZ)(w.v,null):(0,pe.tZ)(O.X,null),(0,pe.tZ)(L.X,{size:"sm",py:3},"Changer le logo")))),n.logo&&(0,pe.tZ)(q.P4,{light:{bg:"orange.100"},dark:{bg:"gray.500"}},(0,pe.tZ)(I.xu,{p:5},(0,pe.tZ)("form",{method:"post",onChange:function(){k("formErrorMessage")},onSubmit:h(D)},(0,pe.tZ)(ce.B,{errors:x,name:"formErrorMessage",render:function(e){var t=e.message;return(0,pe.tZ)(c.bZ,{status:"error",mb:3},(0,pe.tZ)(c.zM,null),(0,pe.tZ)(q.h1,null,t))}}),(0,pe.tZ)(te.NI,{id:"file",isInvalid:!!x.file,mb:3},(0,pe.tZ)(re.l,null,"Image"),(0,pe.tZ)(q.II,{height:"auto",py:3,name:"file",type:"file",accept:"image/*",onChange:function(){var e=(0,s.Z)(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.target.files||!t.target.files[0]){e.next=8;break}if(!(t.target.files[0].size<1e6)){e.next=8;break}return e.t0=E,e.next=5,se(t.target.files[0]);case 5:e.t1=e.sent,(0,e.t0)(e.t1),k("file");case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ref:Z({validate:function(e){return!(e&&e[0]&&e[0].size>=1e6)||"L'image ne doit pas d\xe9passer 1Mo."}})}),(0,pe.tZ)(ne.J,null,(0,pe.tZ)(ce.B,{errors:x,name:"file"}))),P&&(0,pe.tZ)(G(),{ref:z,image:P,width:220,height:220,border:0,color:[255,255,255,.6],scale:1,rotate:0,style:{marginBottom:"12px"}}),(0,pe.tZ)(q.zx,{colorScheme:"green",type:"submit",isLoading:m.isLoading,isDisabled:Object.keys(x).length>0},"Valider")))))};function he(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ye(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?he(Object(r),!0).forEach((function(t){(0,J.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):he(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var xe={name:"1vkc4pg",styles:"&:hover{--tw-bg-opacity:1;background-color:rgba(110, 231, 183, var(--tw-bg-opacity));;}"},ke=function(e){var t=e.session,r=e.event,n=e.eventQuery,o=(e.isConfig,e.isEdit),i=e.isVisible,u=e.setIsConfig,l=e.setIsEdit,c=e.setIsVisible,f=(0,d.useRouter)(),g=(0,S.useToast)({position:"top"}),m=(0,X.gV)(),b=(0,v.Z)(m,2),Z=b[0],x=b[1],k=(0,p.useState)(!0),w=k[0],O=k[1];return(0,pe.tZ)(p.Fragment,null,(0,pe.tZ)(I.xu,{mb:3},!o&&(0,pe.tZ)(p.Fragment,null,(0,pe.tZ)(q.zx,{"aria-label":"Modifier",leftIcon:(0,pe.tZ)(T.J,{as:o?h.R:y.d}),mr:3,onClick:function(){l(!o),c(ye(ye({},i),{},{banner:!1}))},css:xe,"data-cy":"eventEdit"},"Modifier"),(0,pe.tZ)(q.m1,{isDisabled:w,isLoading:x.isLoading,header:(0,pe.tZ)(p.Fragment,null,"Vous \xeates sur le point de supprimer l'\xe9v\xe9nement",(0,pe.tZ)(C.x,{display:"inline",color:"red",fontWeight:"bold"}," ".concat(r.eventName))),body:(0,pe.tZ)(p.Fragment,null,"Saisissez le nom de l'\xe9v\xe9nement pour confimer sa suppression :",(0,pe.tZ)(q.II,{autoComplete:"off",onChange:function(e){return O(e.target.value!==r.eventName)}})),onClick:(0,s.Z)(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Z({eventUrl:r.eventUrl}).unwrap();case 3:if(!(t=e.sent)){e.next=8;break}return e.next=7,f.push("/");case 7:g({title:"".concat(t.eventName," a bien \xe9t\xe9 supprim\xe9 !"),status:"success",isClosable:!0});case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),g({title:e.t0.data?e.t0.data.message:e.t0.message,status:"error",isClosable:!0});case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))}))),o?(0,pe.tZ)(Y.$,{session:t,event:r,onCancel:function(){return l(!1)},onSubmit:function(){var e=(0,s.Z)(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r||t===r.eventUrl){e.next=5;break}return e.next=3,f.push("/".concat(t),"/".concat(t),{shallow:!0});case 3:e.next=8;break;case 5:n.refetch(),l(!1),u(!1);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}):(0,pe.tZ)(p.Fragment,null,(0,pe.tZ)(Ze,{event:r,eventQuery:n,isVisible:i,setIsVisible:c,mb:3}),(0,pe.tZ)(me,{event:r,eventQuery:n,isVisible:i,setIsVisible:c,mb:3})))},we=r(17377),Oe=r(4252),Se=r(68978),je=r(56185),Ie=r(28488),Ce=r(73955),Pe=r(79887),Ee=r(43185),Ne=r(18716),Le=r(34281),ze=r(77059),De=r(71096),Te=r(49444),Ve=r(5665),Ae=r(61955),Re=r(80006),_e=r(49759);function Me(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Be(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Me(Object(r),!0).forEach((function(t){(0,J.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Me(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ue=function(e){var t=e.event,r=e.org,n=e.notifType,o=e.subQuery,i=e.userEmail,c=(0,u.Z)(e,["event","org","notifType","subQuery","userEmail"]),d=(0,S.useToast)({position:"top"}),f=Be({},c.followerSubscription),g=(0,p.useState)(!1),m=g[0],b=g[1],Z=(0,p.useState)(!1),h=Z[0],y=Z[1],x=(0,p.useState)(!1),k=x[0],w=x[1],O=(0,p.useState)({}),j=O[0],I=O[1],P=(0,p.useState)(!f.tagTypes||f.tagTypes.includes("Topics")),E=P[0],N=P[1];(0,p.useEffect)((function(){var e=o.data?o.data.topics.reduce((function(e,n){var o,i=n.topic,a=i._id||"",s=!1;if(r)s=("string"===typeof i.org?i.org:null===(o=i.org)||void 0===o?void 0:o._id)===r._id;else if(t){var u;s=("string"===typeof i.event?i.event:null===(u=i.event)||void 0===u?void 0:u._id)===t._id}return s?(Be(Be({},e),{},(0,J.Z)({},a,{topic:i,checked:!0}))):e}),{}):{};I(e)}),[o.data]);var L=(0,De.h_)(),z=(0,v.Z)(L,2),D=z[0],T=(z[1],(0,p.useState)(!f.tagTypes||f.tagTypes.includes("Events"))),V=T[0],R=T[1],_=(0,p.useState)(!1),M=_[0],B=_[1],U=(0,p.useState)({}),Q=U[0],q=U[1];(0,p.useEffect)((function(){if(r){var e=Object.keys(A.WD).reduce((function(e,t){var r;if(!(0,Ne.u1)(f))return e;var o=parseInt(t);if(0===o)return e;var i=!(null===(r=f.eventCategories)||void 0===r||!r.find((function(e){var t=e.catId,r=e.emailNotif,i=e.pushNotif;return"email"===n?t===o&&r:t===o&&i})));return Be(Be({},e),{},(0,J.Z)({},o,{checked:i}))}),{});q(e)}}),[c.followerSubscription]);var F=function(){var e=(0,s.Z)(a().mark((function e(s){var u,l,c,p,g;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,b(!0),(u={}).topics=Object.keys(j).filter((function(e){return j[e].checked})).map((function(e){return{topic:j[e].topic,emailNotif:"email"===n||void 0,pushNotif:"push"===n||void 0}})),!("orgId"in f)){e.next=20;break}(l=Be({},f)).eventCategories=[],c=function(){var e,t=g[p];if(!Q[parseInt(t)].checked)return"continue";var r=null===(e=f.eventCategories)||void 0===e?void 0:e.find((function(e){return e.catId===parseInt(t)})),o=Be({},r);r?"email"===n?o.emailNotif=!0:o.pushNotif=!0:o={catId:parseInt(t),emailNotif:"email"===n||void 0,pushNotif:"push"===n||void 0},l.eventCategories.push(o)},p=0,g=Object.keys(Q);case 11:if(!(p<g.length)){e.next=18;break}if("continue"!==c()){e.next=15;break}return e.abrupt("continue",15);case 15:p++,e.next=11;break;case 18:l.eventCategories.length||delete l.eventCategories,u.orgs=[l];case 20:return e.next=22,D({payload:u,email:i}).unwrap();case 22:o.refetch(),null!==s&&void 0!==s&&s.silent||d({title:"Votre abonnement \xe0 ".concat(r?r.orgName:t.eventName," a bien \xe9t\xe9 modifi\xe9 !"),status:"success"}),e.next=30;break;case 26:e.prev=26,e.t0=e.catch(2),console.error(e.t0),d({status:"error",title:"Nous n'avons pas pu modifier votre abonnement"});case 30:return e.prev=30,b(!1),e.finish(30);case 33:case"end":return e.stop()}}),e,null,[[2,26,30,33]])})));return function(t){return e.apply(this,arguments)}}();return(0,pe.tZ)(Se.J2,{isLazy:!0,isOpen:h,onClose:function(){F({silent:!0}),w(!1),y(!1)}},(0,pe.tZ)(Se.xo,null,(0,pe.tZ)(je.z,{leftIcon:"email"===n?(0,pe.tZ)(we.L,null):(0,pe.tZ)(Oe.D,null),colorScheme:"teal",onClick:(0,s.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:y(!h);case 1:case"end":return e.stop()}}),e)}))),"data-cy":"subscribeToOrg"},"email"===n?"Notifications e-mail":"Notifications mobile")),(0,pe.tZ)(Se.yk,null,o.data?(0,pe.tZ)(Se.Yt,null,(0,pe.tZ)(C.x,null,i),(0,pe.tZ)(Te.r,{href:"/unsubscribe/".concat(r?r.orgUrl:null===t||void 0===t?void 0:t.eventUrl,"?subscriptionId=").concat(o.data._id),fontSize:"smaller",variant:"underline"},"Se d\xe9sabonner de ",r?(0,_e.rY)(r.orgType):"l'\xe9v\xe9nement")):i&&(0,pe.tZ)(Se.Yt,null,(0,pe.tZ)(C.x,null,"Abonnement de ",i)),(0,pe.tZ)(Se.b,null,(0,pe.tZ)(te.NI,null,(0,pe.tZ)(p.Fragment,null,o.isLoading||o.isFetching?(0,pe.tZ)(l.$,null):(0,pe.tZ)(p.Fragment,null,"Recevoir une notification"," ","email"===n?"e-mail":"mobile"," pour :",r&&(0,pe.tZ)(p.Fragment,null,(0,pe.tZ)(Ve.r,{display:"flex",alignItems:"center",cursor:"pointer",my:3,isChecked:V,isDisabled:m,onChange:function(){var e=(0,s.Z)(a().mark((function e(t){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log(t.target.checked?"adding tagType":"removing tagType"),b(!0),R(t.target.checked),!(0,Ne.u1)(f)){e.next=9;break}return r={orgs:[Be(Be({},f),{},{tagTypes:t.target.checked?(0,Ne.Nc)("Events",f):(0,Ne.J8)("Events",f)})]},e.next=8,D({payload:r,email:i});case 8:o.refetch();case 9:e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),console.error(e.t0),d({status:"error",title:"Nous n'avons pas pu modifier votre abonnement"});case 15:return e.prev=15,b(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[0,11,15,18]])})));return function(t){return e.apply(this,arguments)}}()},"un nouvel \xe9v\xe9nement"),(0,pe.tZ)(Ve.r,{display:"flex",alignItems:"center",cursor:"pointer",my:3,isChecked:M,onChange:function(e){var t;e.target.checked||q((t={checked:!1},Object.keys(A.WD).reduce((function(e,r){var n=parseInt(r);return 0===n?e:Be(Be({},e),{},(0,J.Z)({},n,t))}),{}))),B(!M)}},"un nouvel \xe9v\xe9nement de la cat\xe9gorie..."),M&&(0,pe.tZ)(p.Fragment,null,o.isLoading||o.isFetching?(0,pe.tZ)(C.x,null,"Chargement..."):(0,pe.tZ)(Ae.c,null,(0,pe.tZ)($.gC,{alignItems:"flex-start",ml:3},Object.keys(Q).map((function(e){var t=parseInt(e),r=A.WD[t];return(0,pe.tZ)(Re.X,{key:t,isChecked:Q[t].checked,onChange:function(e){var r;if((0,Ne.u1)(f)){var n=!(null===(r=f.eventCategories)||void 0===r||!r.find((function(e){return e.catId===t})));w(e.target.checked!==n),q(Be(Be({},Q),{},(0,J.Z)({},t,{checked:e.target.checked})))}}},r.label)})))))),(0,pe.tZ)(Ve.r,{display:"flex",alignItems:"center",cursor:"pointer",my:3,isChecked:E,isDisabled:m,onChange:function(){var e=(0,s.Z)(a().mark((function e(t){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,b(!0),N(t.target.checked),r=(0,Ne.u1)(f)?{orgs:[Be(Be({},f),{},{tagTypes:t.target.checked?(0,Ne.Nc)("Topics",f):(0,Ne.J8)("Topics",f)})]}:{events:[Be(Be({},f),{},{tagTypes:t.target.checked?(0,Ne.Nc)("Topics",f):(0,Ne.J8)("Topics",f)})]},e.next=6,D({payload:r,email:i});case 6:o.refetch(),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0),d({status:"error",title:"Nous n'avons pas pu modifier votre abonnement"});case 13:return e.prev=13,b(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[0,9,13,16]])})));return function(t){return e.apply(this,arguments)}}()},"une nouvelle discussion"),Object.keys(j).length>0&&(0,pe.tZ)(p.Fragment,null,"- une r\xe9ponse \xe0 la discussion...",(0,pe.tZ)(Ae.c,null,(0,pe.tZ)($.gC,{alignItems:"flex-start",mt:3,ml:3},Object.keys(j).map((function(e){var t=j[e].checked,r=j[e].topic;return(0,pe.tZ)(Re.X,{key:e,isChecked:t,onChange:function(t){var r,n=!(null===(r=o.data)||void 0===r||!r.topics.find((function(t){return t.topic._id===e})));w(t.target.checked!==n),I(Be(Be({},j),{},(0,J.Z)({},e,Be(Be({},j[e]),{},{checked:t.target.checked}))))}},r.topicName)}))))))))),(0,pe.tZ)(Se.DT,null,(0,pe.tZ)(je.z,{colorScheme:"green",isDisabled:m||!k,onClick:function(){return F()}},"Valider"))))},Qe=function(e){var t=e.org,r=e.event,n=e.query,o=e.subQuery,i=e.notifType,l=void 0===i?"email":i,c=(0,u.Z)(e,["org","event","query","subQuery","notifType"]);if(!t&&!r)return null;var d=(0,R.k)().data,g=(0,S.useToast)({position:"top"}),m=(0,Le.TL)(),b=(0,f.v9)(Ee.I_)||(null===d||void 0===d?void 0:d.user.email),Z=(0,De.h_)(),h=(0,v.Z)(Z,2),y=h[0],x=(h[1],c.followerSubscription),k=(0,p.useState)(!1),w=k[0],O=k[1],j=(0,p.useState)(!1),I=j[0],C=j[1],P=(0,ue.cI)({mode:"onChange"}),E=P.errors,N=P.handleSubmit,L=P.register,z=function(){var e=(0,s.Z)(a().mark((function e(i){var s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return C(!0),s={},t?s.orgs=[{org:t,orgId:t._id,type:Ne.NY.FOLLOWER,tagTypes:["Events","Topics"]}]:r&&(s.events=[{event:r,eventId:r._id,tagTypes:["Topics"]}]),e.prev=3,e.next=6,y({payload:s,email:i||b}).unwrap();case 6:n.refetch(),o.refetch(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),g({status:"error",title:"Nous n'avons pas pu vous abonner"});case 13:return e.prev=13,C(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,10,13,16]])})));return function(t){return e.apply(this,arguments)}}(),D=function(){var e=(0,s.Z)(a().mark((function e(t){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.email){e.next=3;break}return e.abrupt("return");case 3:return C(!0),m((0,Ee.WG)(r)),e.next=7,z(r);case 7:C(!1);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return b?(0,pe.tZ)(p.Fragment,null,o.isLoading||o.isFetching||x?x&&(0,pe.tZ)(Ue,{event:r,org:t,followerSubscription:x,notifType:l,subQuery:o,userEmail:b}):(0,pe.tZ)(je.z,{isLoading:I,leftIcon:"email"===l?(0,pe.tZ)(we.L,null):(0,pe.tZ)(Oe.D,null),colorScheme:"teal",onClick:function(){return z()},"data-cy":"subscribeToOrg"},"S'abonner")):(0,pe.tZ)(Se.J2,{isLazy:!0,isOpen:w,onClose:function(){return O(!1)}},(0,pe.tZ)(Se.xo,null,(0,pe.tZ)(je.z,{isLoading:I,leftIcon:"email"===l?(0,pe.tZ)(we.L,null):(0,pe.tZ)(Oe.D,null),colorScheme:"teal",onClick:(0,s.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:O(!w);case 1:case"end":return e.stop()}}),e)}))),"data-cy":"subscribeToOrg"},"S'abonner")),(0,pe.tZ)(Se.yk,{ml:0},(0,pe.tZ)("form",{onChange:function(){},onSubmit:N(D)},(0,pe.tZ)(Se.b,null,(0,pe.tZ)(te.NI,{id:"email",isRequired:!0,isInvalid:!!E.email},(0,pe.tZ)(Ie.B,null,(0,pe.tZ)(Ce.Z,{pointerEvents:"none",children:"email"===l?(0,pe.tZ)(we.L,null):(0,pe.tZ)(Oe.D,null)}),(0,pe.tZ)(Pe.I,{name:"email",placeholder:"Entrez votre adresse e-mail",ref:L({required:"Veuillez saisir votre adresse e-mail",pattern:{value:ze.GN,message:"Adresse e-mail invalide"}})})),(0,pe.tZ)(ne.J,null,(0,pe.tZ)(ce.B,{errors:E,name:"email"})))),(0,pe.tZ)(Se.DT,null,(0,pe.tZ)(je.z,{colorScheme:"green",type:"submit",isLoading:I,isDisabled:Object.keys(E).length>0},"Valider")))))},qe=r(1430),Fe=function(e){var t=e.email,r=e.setEmail,n=e.event,o=e.eventQuery,i=(0,R.k)(),u=i.data,d=(i.loading,(0,S.useToast)({position:"top"})),f=(0,X.VA)(),g=(0,v.Z)(f,2),m=g[0],b=g[1],Z=function(){var e=(0,s.Z)(a().mark((function e(){var i,s,l,c,p;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=null,u||t){e.next=7;break}if((s=prompt("Veuillez entrer votre adresse e-mail :"))&&ze.GN.test(s)){e.next=6;break}return d({status:"error",title:"Adresse e-mail invalide"}),e.abrupt("return");case 6:r(s);case 7:if(l=s||t,!(0,A.po)({email:l,event:n})){e.next=11;break}return d({status:"error",title:"Vous participez d\xe9j\xe0 \xe0 cet \xe9v\xe9nement"}),e.abrupt("return");case 11:return c=!1,p=null===(i=n.eventNotified)||void 0===i?void 0:i.map((function(e){var t=e.email,r=e.status;return t===l&&r!==A.Sk.OK?(c=!0,{email:t,status:A.Sk.OK}):{email:t,status:r}})),!c&&l&&(null===p||void 0===p||p.push({email:l,status:A.Sk.OK})),e.next=16,m({payload:{eventNotified:p},eventUrl:n.eventUrl});case 16:o.refetch();case 17:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),h=function(){var e=(0,s.Z)(a().mark((function e(){var i,s,l,c,p;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=null,u||t){e.next=7;break}if((s=prompt("Veuillez entrer votre adresse e-mail :"))&&ze.GN.test(s)){e.next=6;break}return d({status:"error",title:"Adresse e-mail invalide"}),e.abrupt("return");case 6:r(s);case 7:if(l=s||t,!(0,A.iu)({email:l,event:n})){e.next=11;break}return d({status:"error",title:"Vous avez d\xe9j\xe0 indiqu\xe9 ne pas participer \xe0 cet \xe9v\xe9nement"}),e.abrupt("return");case 11:return c=!0,p=null===(i=n.eventNotified)||void 0===i?void 0:i.map((function(e){var t=e.email,r=e.status;return t===l&&r!==A.Sk.NOK?(c=!1,{email:t,status:A.Sk.NOK}):{email:t,status:r}})),c&&l&&(null===p||void 0===p||p.push({email:l,status:A.Sk.NOK})),e.next=16,m({payload:{eventNotified:p},eventUrl:n.eventUrl});case 16:o.refetch();case 17:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,pe.tZ)(c.bZ,{mb:3,status:(0,A.po)({email:t,event:n})?"success":(0,A.iu)({email:t,event:n})?"error":"info"},(0,pe.tZ)(c.zM,null),(0,A.po)({email:t,event:n})?(0,pe.tZ)(j.k,{flexDirection:"column"},(0,pe.tZ)(C.x,{as:"h3"},"Vous participez \xe0 cet \xe9v\xe9nement."),(0,pe.tZ)(I.xu,null,(0,pe.tZ)(q.zx,{colorScheme:"red",isLoading:b.isLoading||o.isFetching||o.isLoading,onClick:(0,s.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:confirm("\xcates-vous s\xfbr de ne plus vouloir participer \xe0 cet \xe9v\xe9nement ?")&&h();case 2:case"end":return e.stop()}}),e)})))},"Ne plus participer"))):(0,A.iu)({email:t,event:n})?(0,pe.tZ)(j.k,{flexDirection:"column"},(0,pe.tZ)(C.x,{as:"h3"},"Vous avez refus\xe9 de participer \xe0 cet \xe9v\xe9nement."),(0,pe.tZ)(I.xu,null,(0,pe.tZ)(q.zx,{colorScheme:"green",mr:3,isLoading:b.isLoading||o.isFetching||o.isLoading,onClick:Z},"Participer"))):(0,pe.tZ)(j.k,{flexDirection:"column"},(0,pe.tZ)(C.x,{as:"h3"},"Participer \xe0 cet \xe9v\xe9nement ?"),(0,pe.tZ)(I.xu,{mt:2},b.isLoading||o.isFetching||o.isLoading?(0,pe.tZ)(l.$,null):(0,pe.tZ)(p.Fragment,null,(0,pe.tZ)(q.zx,{colorScheme:"green",mr:3,onClick:Z},"Oui"),(0,pe.tZ)(q.zx,{colorScheme:"red",onClick:function(){h()}},"Non")))))},We=r(1609);function Je(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Xe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Je(Object(r),!0).forEach((function(t){(0,J.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Je(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ye=function(e){var t=e.event,r=e.eventQuery,n=(e.session,(0,u.Z)(e,["event","eventQuery","session"])),o=(0,S.useToast)({position:"top"}),i="dark"===(0,S.useColorMode)().colorMode,d=(0,X.SO)(),f=(0,v.Z)(d,2),g=f[0],m=(f[1],Array.isArray(t.eventNotified)?t.eventNotified.length:0),b=(0,p.useState)(!1),Z=b[0],h=b[1],y=(0,ue.cI)({mode:"onChange"}),x=y.control,k=y.register,w=y.handleSubmit,O=y.errors,I=(y.setError,y.clearErrors,y.watch,y.setValue,y.getValues),C=(y.trigger,function(){var e=(0,s.Z)(a().mark((function e(i){var s,u,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("submitted",i),h(!0),s=Xe(Xe({},i),{},{orgIds:"boolean"===typeof i.orgIds?[]:"string"===typeof i.orgIds?[i.orgIds]:i.orgIds}),e.prev=3,e.next=6,g({eventUrl:t.eventUrl,payload:s}).unwrap();case 6:u=e.sent,(0,We.t)(u.emailList)?(r.refetch(),l=u.emailList.length>1?"s":"",o({title:"Une invitation a \xe9t\xe9 envoy\xe9e \xe0 ".concat(i.email?i.email:"".concat(u.emailList.length," abonn\xe9").concat(l)),status:"success",isClosable:!0})):o({title:"Aucune invitation envoy\xe9e",status:"warning",isClosable:!0}),n.onSubmit&&n.onSubmit(),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(3),console.error(e.t0),o({title:"Une erreur est survenue",status:"error",isClosable:!0});case 15:return e.prev=15,h(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[3,11,15,18]])})));return function(t){return e.apply(this,arguments)}}());return(0,pe.tZ)("form",{onSubmit:w(C)},(0,pe.tZ)(c.bZ,{status:"info",mt:3},(0,pe.tZ)(j.k,{flexDirection:"column"},"Pour envoyer un e-mail d'invitation aux abonn\xe9s des organisations de cet \xe9v\xe9n\xe9ment, cochez une ou plusieurs des cases correspondantes :",(0,pe.tZ)(te.NI,{isInvalid:!!O.orgIds},(0,pe.tZ)(Ae.c,null,(0,pe.tZ)(V.iA,{backgroundColor:i?"whiteAlpha.100":"blackAlpha.100",borderWidth:"1px",borderRadius:"lg",mt:2},(0,pe.tZ)(V.p3,null,r.isLoading||r.isFetching?(0,pe.tZ)(V.Tr,null,(0,pe.tZ)(V.Td,{colSpan:3},(0,pe.tZ)(l.$,null))):t.eventOrgs.map((function(e){var t=e.orgSubscriptions.map((function(t){return t.orgs.filter((function(t){return t.orgId===e._id&&t.type===Ne.NY.FOLLOWER})).length})).reduce((function(e,t){return e+t}),0)-m,r=t>1?"s":"";return(0,pe.tZ)(V.Tr,{key:e.orgName,mb:1},(0,pe.tZ)(V.Td,null,(0,pe.tZ)(Re.X,{icon:(0,pe.tZ)(we.L,null),name:"orgIds",ref:k({required:"Veuillez s\xe9lectionner une organisation au minimum"}),value:e._id},e.orgName)),(0,pe.tZ)(V.Td,{textAlign:"right"},(0,pe.tZ)(P.Vp,{fontSize:"smaller"},t," abonn\xe9",r," n'",r?"ont":"a"," pas \xe9t\xe9 invit\xe9",r)))}))))),(0,pe.tZ)(ne.J,null,(0,pe.tZ)(ce.B,{errors:O,name:"orgIds"}))),(0,pe.tZ)(q.sm,{name:"email",label:"(facultatif) envoyer l'invitation seulement \xe0 l'adresse e-mail de votre choix :",control:x,register:k,errors:O,placeholder:"Envoyer \xe0 cette adresse e-mail uniquement",mt:3,isMultiple:!1}),(0,pe.tZ)(j.k,{justifyContent:"flex-end",mt:3},(0,pe.tZ)(je.z,{colorScheme:"green",type:"submit",isLoading:Z},"Envoyer ",I("email")?"une invitation":"")))))},Ke=r(9273),Ge=r(2765),He=r(59359),$e=r(84947);var et={name:"1utmw3m",styles:"-webkit-overflow-scrolling:touch;-ms-overflow-style:-ms-autohiding-scrollbar"},tt=function(e){var t=e.isCreator,r=e.children,n=((0,u.Z)(e,["isCreator","children"]),(0,S.chakra)("button",{themeKey:"Tabs.Tab"})),i=(0,S.useColorModeValue)("gray.100","whiteAlpha.300"),a=(0,p.useState)(0),s=a[0],l=a[1],c=[{name:"Accueil",icon:Ke.x},{name:"Discussions",icon:$e.k}];t&&c.push({name:"Invitations",icon:we.L});var d=p.forwardRef((function(e,t){var r=e.icon,a=e.tabIndex,l=(0,u.Z)(e,["icon","tabIndex"]),c=(0,Ge.xD)(l);c.tabIndex=0,s===a&&(c["aria-selected"]=!0);var d=(0,S.useStyles)();return(0,pe.tZ)(n,(0,o.Z)({display:"flex",flex:He.tq?"0 0 auto":"1",alignItems:"center",justifyContent:"center",bg:i,mx:1,_focus:{boxShadow:"none"}},c,{__css:d.tab}),(0,pe.tZ)("span",{style:{display:"inline-flex",flexShrink:"0",marginInlineEnd:"0.5rem"}},(0,pe.tZ)(T.J,{as:r,boxSize:5,verticalAlign:"middle"})),c.children)}));return(0,pe.tZ)(E.mQ,{defaultIndex:0,index:s,onChange:function(e){return l(e)},isFitted:!0,variant:"solid-rounded",borderWidth:1,borderColor:"gray.200",borderRadius:"lg",isManual:!0,isLazy:!0,lazyBehavior:"keepMounted"},(0,pe.tZ)(E.td,{as:"nav",display:"flex",flexWrap:"nowrap",alignItems:"center",height:"60px",overflowX:"auto",mx:3,css:et,"aria-hidden":!0},c.map((function(e,t){var r=e.name,n=e.icon;return(0,pe.tZ)(d,{key:"eventTab-".concat(t),tabIndex:t,icon:n,"data-cy":"eventTab-".concat(r)},r)}))),r)},rt=r(59829),nt=r(64263);function ot(e,t){var r;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"===typeof e)return it(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return it(e,t)}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}function it(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var at,st=!1,ut=!1,lt={name:"1qrf9a4",styles:"&{grid-template-columns:minmax(425px, 1fr) minmax(170px, 1fr);}@media (max-width: 700px){&{grid-template-columns:1fr!important;}}"},ct=function(e){var t,r,n,i,a,s=(0,o.Z)({},e),u=(0,d.useRouter)(),l=(0,R.k)(),U=l.data,J=(l.loading,U||s.session),Y=((0,S.useToast)({position:"top"}),(0,S.useColorMode)().colorMode,(0,f.v9)(Ee.I_)||(null===J||void 0===J?void 0:J.user.email)),K=(0,X.Tl)({eventUrl:s.event.eventUrl},{selectFromResult:function(e){return e}}),G=K.data||s.event,H=(0,f.v9)(rt.MI);(0,p.useEffect)((function(){H!==st&&(st=H,console.log("refetching event"),K.refetch())}),[H]),(0,p.useEffect)((function(){Y!==at&&(at=Y,console.log("refetching event with new email",Y),K.refetch())}),[Y]),(0,p.useEffect)((function(){console.log("refetching event with new route",u.asPath),K.refetch(),xe(!1)}),[u.asPath]);var $=G.createdBy&&"object"===typeof G.createdBy?G.createdBy.userName||G.createdBy._id:"",ee=G.createdBy&&"object"===typeof G.createdBy?G.createdBy._id:"",te=(null===J||void 0===J?void 0:J.user.userId)===ee||(null===J||void 0===J?void 0:J.user.isAdmin),re=(0,De.h_)(),ne=(0,v.Z)(re,2),oe=(ne[0],ne[1],(0,De.xu)(Y)),ie=(0,f.v9)(qe.di);(0,p.useEffect)((function(){ie!==ut&&(ut=ie,console.log("refetching subscription"),oe.refetch())}),[ie]),(0,p.useEffect)((function(){Y!==at&&(at=Y,console.log("refetching subscription with new email",Y),oe.refetch())}),[Y]);var ae,se=(0,qe.C3)({event:G,subQuery:oe}),ue=te||!(null===(t=oe.data)||void 0===t||!t.orgs.find((function(e){var t,r=ot(G.eventOrgs);try{for(r.s();!(t=r.n()).done;){if(t.value._id===e.orgId&&e.type===Ne.NY.SUBSCRIBER)return!0}}catch(n){r.e(n)}finally{r.f()}return!1}))),le=(0,p.useState)(Y),ce=le[0],de=le[1],fe=(0,p.useState)(0),ge=fe[0],me=fe[1],be=(0,p.useState)(!1),ve=be[0],Ze=be[1],he=(0,p.useState)(!1),ye=he[0],xe=he[1],we=(0,p.useState)({topics:!1,banner:!1,logo:!1}),Oe=we[0],Se=we[1],je=(0,p.useState)(!1),Ie=je[0],Ce=je[1],Pe=!1;J?!te&&ue&&(Pe=!0):G.eventVisibility===A.Hk.SUBSCRIBERS?null!==(ae=G.eventNotified)&&void 0!==ae&&ae.find((function(e){return e.email===ce}))&&(Pe=!0):Pe=!0;return(0,pe.tZ)(W.Ar,{event:G,isLogin:ge,session:s.session},te&&!ve?(0,pe.tZ)(q.zx,{colorScheme:"teal",leftIcon:(0,pe.tZ)(Z.e,{boxSize:6,"data-cy":"eventSettings"}),onClick:function(){return Ze(!0)},mb:2},"Param\xe8tres de l'\xe9v\xe9nement"):ve&&!ye?(0,pe.tZ)(q.zx,{colorScheme:"pink",leftIcon:(0,pe.tZ)(h.R,{boxSize:6}),onClick:function(){return Ze(!1)},mb:2},"Revenir \xe0 l'\xe9v\xe9nement"):null,!oe.isLoading&&!ve&&(0,pe.tZ)(j.k,{flexDirection:"row",flexWrap:"wrap",mt:-3},se&&(0,pe.tZ)(I.xu,{mr:3,mt:3},(0,pe.tZ)(Qe,{event:G,query:K,subQuery:oe,followerSubscription:se})),(0,pe.tZ)(I.xu,{mt:3},(0,pe.tZ)(Qe,{event:G,query:K,subQuery:oe,followerSubscription:se,notifType:"push"}))),(0,pe.tZ)(I.xu,{mb:3},(0,pe.tZ)(C.x,{fontSize:"smaller",pt:1},"\xc9v\xe9nement ajout\xe9 le"," ",(0,_.default)((0,M.default)(G.createdAt),"eeee d MMMM yyyy",{locale:B.Z})," ","par :"," ",(0,pe.tZ)(q.rU,{variant:"underline",href:"/".concat($)},$)," ",te&&"(Vous)")),te&&!G.isApproved&&(0,pe.tZ)(c.bZ,{status:"info",mb:3},(0,pe.tZ)(c.zM,null),(0,pe.tZ)(I.xu,null,(0,pe.tZ)(C.x,null,"Votre \xe9v\xe9nement est en attente de mod\xe9ration."),(0,pe.tZ)(C.x,{fontSize:"smaller"},"Vous devez attendre son approbation avant de pouvoir envoyer un e-mail d'invitation aux adh\xe9rents des organisateurs."))),G.eventVisibility===A.Hk.SUBSCRIBERS&&!ve&&(0,pe.tZ)(c.bZ,{status:ue?"success":"warning",mb:3},(0,pe.tZ)(c.zM,null),(0,pe.tZ)(I.xu,null,(0,pe.tZ)(C.x,{as:"h3"},"Cet \xe9v\xe9nement est reserv\xe9 aux adh\xe9rents des organisations suivantes :"," ",G.eventOrgs.map((function(e){return(0,pe.tZ)(q.rU,{key:e._id,href:e.orgUrl,shallow:!0},(0,pe.tZ)(P.Vp,{mx:1},e.orgName))}))))),Pe&&(0,pe.tZ)(Fe,{email:ce,setEmail:de,event:G,eventQuery:K}),!ve&&(0,pe.tZ)(tt,{isCreator:te},(0,pe.tZ)(E.nP,null,(0,pe.tZ)(E.x4,{"aria-hidden":!0},(0,pe.tZ)(N.r,{gridGap:5,css:lt},(0,pe.tZ)(q.P4,{rowSpan:3,borderTopRadius:"lg",light:{bg:"orange.100"},dark:{bg:"gray.500"}},(0,pe.tZ)(q.Q1,{borderTopRadius:"lg",alignItems:"center"},(0,pe.tZ)(j.k,{flexDirection:"row",alignItems:"center"},(0,pe.tZ)(L.X,{size:"sm",py:3},"Description de l'\xe9v\xe9nement"),G.eventDescription&&te&&(0,pe.tZ)(z.u,{placement:"bottom",label:"Modifier la description"},(0,pe.tZ)(D.h,{"aria-label":"Modifier la description",icon:(0,pe.tZ)(y.d,null),bg:"transparent",ml:3,_hover:{color:"green"},onClick:function(){Ze(!0),xe(!0)}})))),(0,pe.tZ)(q.P4,null,(0,pe.tZ)(I.xu,{className:"ql-editor",p:5},G.eventDescription&&G.eventDescription.length>0?(0,pe.tZ)("div",{dangerouslySetInnerHTML:{__html:Q().sanitize(G.eventDescription)}}):te?(0,pe.tZ)(q.rU,{onClick:function(){Ze(!0),xe(!0)},variant:"underline"},"Cliquez ici pour ajouter la description de l'\xe9v\xe9nement."):(0,pe.tZ)(C.x,{fontStyle:"italic"},"Aucune description.")))),(0,pe.tZ)(q.P4,{light:{bg:"orange.100"},dark:{bg:"gray.500"},borderTopRadius:"lg"},(0,pe.tZ)(N.r,{templateRows:"auto 1fr"},(0,pe.tZ)(q.Q1,{borderTopRadius:"lg",alignItems:"center"},(0,pe.tZ)(L.X,{size:"sm",py:3},"Quand ?")),(0,pe.tZ)(q.P4,{light:{bg:"orange.100"},dark:{bg:"gray.500"}},(0,pe.tZ)(I.xu,{ml:3,pt:3},(0,pe.tZ)(nt.G,{event:G}))))),(0,pe.tZ)(q.P4,{light:{bg:"orange.100"},dark:{bg:"gray.500"},borderTopRadius:"lg"},(0,pe.tZ)(N.r,{templateRows:"auto 1fr"},(0,pe.tZ)(q.Q1,{borderTopRadius:"lg",alignItems:"center"},(0,pe.tZ)(L.X,{size:"sm",py:3},"Coordonn\xe9es")),(0,pe.tZ)(q.P4,{light:{bg:"orange.100"},dark:{bg:"gray.500"}},(0,pe.tZ)(I.xu,{p:5},G.eventAddress&&(0,pe.tZ)(j.k,{flexDirection:"column"},(0,pe.tZ)(j.k,{alignItems:"center"},(0,pe.tZ)(T.J,{as:b.r,mr:3}),G.eventAddress)),G.eventEmail&&(0,pe.tZ)(j.k,{flexDirection:"column"},null===(r=G.eventEmail)||void 0===r?void 0:r.map((function(e,t){var r=e.email;return(0,pe.tZ)(j.k,{key:"phone-".concat(t),alignItems:"center"},(0,pe.tZ)(x.K,{mr:3}),(0,pe.tZ)(q.rU,{variant:"underline",href:"mailto:".concat(r)},r))}))),G.eventPhone&&(0,pe.tZ)(j.k,{flexDirection:"column"},null===(n=G.eventPhone)||void 0===n?void 0:n.map((function(e,t){var r=e.phone;return(0,pe.tZ)(j.k,{key:"phone-".concat(t),alignItems:"center"},(0,pe.tZ)(k.q,{mr:3}),(0,pe.tZ)(q.rU,{variant:"underline",href:"tel:+33".concat(r.substr(1,r.length))},r))}))),G.eventWeb&&(0,pe.tZ)(j.k,{flexDirection:"column"},null===(i=G.eventWeb)||void 0===i?void 0:i.map((function(e,t){var r=e.url,n=e.prefix;return(0,pe.tZ)(j.k,{key:"phone-".concat(t),alignItems:"center"},(0,pe.tZ)(T.J,{as:m.j,mr:3}),(0,pe.tZ)(q.rU,{variant:"underline",href:n+r},r))}))))))),(0,pe.tZ)(q.P4,{light:{bg:"orange.100"},dark:{bg:"gray.500"},borderTopRadius:"lg"},(0,pe.tZ)(N.r,{templateRows:"auto 1fr"},(0,pe.tZ)(q.Q1,{borderTopRadius:"lg",alignItems:"center"},(0,pe.tZ)(L.X,{size:"sm",py:3},"Organis\xe9 par")),(0,pe.tZ)(q.P4,{light:{bg:"orange.100"},dark:{bg:"gray.500"}},(0,pe.tZ)(I.xu,{p:5},(0,We.t)(G.eventOrgs)?G.eventOrgs.map((function(e,t){return(0,pe.tZ)(j.k,{key:e._id,mb:2,alignItems:"center"},(0,pe.tZ)(T.J,{as:g.S,mr:2}),(0,pe.tZ)(q.rU,{"data-cy":"eventCreatedBy-".concat(e.orgName),variant:"underline",href:"/".concat(e.orgUrl),shallow:!0},"".concat(e.orgName)))})):(0,pe.tZ)(j.k,{alignItems:"center"},(0,pe.tZ)(T.J,{as:x.K,mr:2}),(0,pe.tZ)(q.rU,{variant:"underline",href:"/".concat($)},$)))))))),(0,pe.tZ)(E.x4,{"aria-hidden":!0},(0,pe.tZ)(F.v,{event:G,query:K,subQuery:oe,isCreator:te,isFollowed:!!se,isLogin:ge,setIsLogin:me})),te&&(0,pe.tZ)(E.x4,{"aria-hidden":!0},(0,pe.tZ)(q.zx,{colorScheme:"teal",rightIcon:Ie?(0,pe.tZ)(w.v,null):(0,pe.tZ)(O.X,null),onClick:function(){G.isApproved?Ce(!Ie):alert("L'\xe9v\xe9nement doit \xeatre v\xe9rifi\xe9 par un mod\xe9rateur avant de pouvoir envoyer des invitations.")}},"Envoyer les invitations"),Ie&&J&&(0,pe.tZ)(Ye,{event:G,eventQuery:K,session:J,onSubmit:function(){return Ce(!1)}}),(0,pe.tZ)(I.xu,{light:{bg:"orange.100"},dark:{bg:"gray.500"},overflowX:"auto",mt:5},!G.eventNotified||Array.isArray(G.eventNotified)&&!G.eventNotified.length?(0,pe.tZ)(C.x,null,"Aucune invitation envoy\xe9e."):(0,pe.tZ)(V.iA,null,(0,pe.tZ)(V.p3,null,null===(a=G.eventNotified)||void 0===a?void 0:a.map((function(e){var t=e.email,r=e.status;return(0,pe.tZ)(V.Tr,{key:t},(0,pe.tZ)(V.Td,null,t),(0,pe.tZ)(V.Td,null,(0,pe.tZ)(P.Vp,{variant:"solid",colorScheme:r===A.Sk.PENDING?"blue":r===A.Sk.OK?"green":"red"},A.EE[r])))})))))))),J&&ve&&(0,pe.tZ)(ke,{session:J,event:G,eventQuery:K,isConfig:ve,isEdit:ye,isVisible:Oe,setIsConfig:Ze,setIsEdit:xe,setIsVisible:Se}))},dt=r(58140),pt=r(99337),ft=r(50862),gt=r(78532),mt=r(9669),bt=r.n(mt),vt=r(7535),Zt=r(82445),ht=function(e){var t=e.org,r=e.isLogin,n=e.setIsLogin,o=((0,u.Z)(e,["org","isLogin","setIsLogin"]),(0,R.k)()),i=o.data,l=o.loading,d=(0,S.useToast)({position:"top"}),f=(0,Zt.An)(t._id),g=(0,p.useState)(0),m=g[0],b=g[1],v=(0,p.useState)(!1),Z=v[0],h=v[1],y=(0,p.useState)(!1),x=y[0],k=y[1],j=(0,ue.cI)({mode:"onChange"}),P=j.register,E=j.handleSubmit,N=j.setError,L=j.errors,z=j.clearErrors,D=(j.watch,function(){var e=(0,s.Z)(a().mark((function e(r){var n,o,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("submitted",r),k(!0),e.prev=2,n=r.files[0],(o=new FormData).append("file",n,n.name),o.append("orgId",t._id),e.next=9,bt().post("https://api.aucourant.de",o,{onUploadProgress:function(e){b(e.loaded/e.total*100)}});case 9:i=e.sent,"OK"===i.statusText&&(d({title:"Votre document a bien \xe9t\xe9 ajout\xe9 !",status:"success"}),f.refetch()),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),(0,le.S)(e.t0,(function(e){return N("formErrorMessage",{type:"manual",message:e})}));case 17:return e.prev=17,k(!1),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[2,14,17,20]])})));return function(t){return e.apply(this,arguments)}}());return(0,pe.tZ)(p.Fragment,null,(0,pe.tZ)(je.z,{colorScheme:"teal",leftIcon:(0,pe.tZ)(ft.d,null),rightIcon:Z?(0,pe.tZ)(w.v,null):(0,pe.tZ)(O.X,null),mb:5,onClick:function(){l||(i?h(!Z):n(r+1))}},"Ajouter"),Z&&(0,pe.tZ)("form",{method:"post",onChange:function(){z("formErrorMessage")},onSubmit:E(D)},(0,pe.tZ)(ce.B,{errors:L,name:"formErrorMessage",render:function(e){var t=e.message;return(0,pe.tZ)(c.bZ,{status:"error",mb:3},(0,pe.tZ)(c.zM,null),(0,pe.tZ)(q.h1,null,t))}}),(0,pe.tZ)(te.NI,{id:"files",isInvalid:!!L.files,mb:3},(0,pe.tZ)(re.l,null,"S\xe9lectionnez un fichier :"),(0,pe.tZ)(Pe.I,{height:"auto",py:3,name:"files",type:"file",accept:"*",onChange:function(){var e=(0,s.Z)(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.target.files&&t.target.files[0]&&(b(0),z("file"),z("formErrorMessage"));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ref:P({required:"Vous devez s\xe9lectionner un fichier",validate:function(e){return!(e&&e[0]&&e[0].size>=5e7)||"Le fichier ne doit pas d\xe9passer 50Mo."}})}),(0,pe.tZ)(ne.J,null,(0,pe.tZ)(ce.B,{errors:L,name:"files"}))),m>0&&100!==m&&(0,pe.tZ)(gt.E,{mb:3,hasStripe:!0,value:m}),(0,pe.tZ)(je.z,{colorScheme:"green",type:"submit",isLoading:x,isDisabled:Object.keys(L).length>0},"Ajouter")),f.isLoading||f.isFetching?(0,pe.tZ)(C.x,null,"Chargement des documents..."):Array.isArray(f.data)&&(0,pe.tZ)(V.iA,null,(0,pe.tZ)(V.p3,null,f.data.map((function(e){var r=vt.Or(e),n=e.includes(".pdf");return(0,pe.tZ)(V.Tr,null,(0,pe.tZ)(V.Td,null,(0,pe.tZ)("a",{href:"".concat("https://api.aucourant.de","/").concat(r||n?"view":"download","?orgId=").concat(t._id,"&fileName=").concat(e),target:"_blank"},(0,pe.tZ)(I.xu,{display:"flex",alignItems:"center"},(0,pe.tZ)(T.J,{as:r?pt.H:dt.p,mr:3}),e))))})))))},yt=r(21526),xt=r(59999),kt=r(55830),wt=r(77787),Ot=r(2728),St=r(74860),jt=r(69822),It=r(39424),Ct=r(38104),Pt=r(27562),Et=r(12207);function Nt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Lt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Nt(Object(r),!0).forEach((function(t){(0,J.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Nt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var zt=function(e){var t,r=e.org,n=(0,u.Z)(e,["org"]),o=(0,S.useToast)({position:"top"}),i=(0,Pt.KV)(),l=(0,v.Z)(i,2),d=l[0],f=l[1],g=(0,Pt.KT)(),m=(0,v.Z)(g,2),b=m[0],Z=m[1],h=(0,p.useState)(!1),y=h[0],x=h[1],k=(0,Et.Gt)({populate:"orgSubscriptions",createdBy:n.session.user.userId}),w=k.data,O=(k.isLoading,(0,ue.cI)({mode:"onChange"})),I=O.control,C=O.register,P=O.handleSubmit,E=O.errors,N=O.setError,L=O.clearErrors,z=O.watch,D=(O.setValue,O.getValues,O.trigger,Object.keys(Ot.qb).map((function(e){return Ot.qb[e]}))),T=Object.keys(Ot.Hk).map((function(e){return Ot.Hk[e]})),V={required:z("projectVisibility")===Ot.Hk.SUBSCRIBERS},A=function(){var e=(0,s.Z)(a().mark((function e(t){var r,i,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("submitted",t),x(!0),i=Lt(Lt({},t),{},{projectDescription:"<p><br></p>"===t.projectDescription?"":null===(r=t.projectDescription)||void 0===r?void 0:r.replace(/\&nbsp;/g," ")}),e.prev=3,!n.project){e.next=10;break}return e.next=7,b({payload:i,projectId:n.project._id}).unwrap();case 7:o({title:"Votre projet a bien \xe9t\xe9 modifi\xe9",status:"success",isClosable:!0}),e.next=18;break;case 10:return e.next=12,d(Lt(Lt({},i),{},{createdBy:n.session.user.userId}));case 12:if(!(s=e.sent).error){e.next=17;break}throw s.error;case 17:o({title:"Votre projet a bien \xe9t\xe9 ajout\xe9 !",status:"success",isClosable:!0});case 18:n.onSubmit&&n.onSubmit(n.project||null),n.onClose&&n.onClose(),e.next=25;break;case 22:e.prev=22,e.t0=e.catch(3),(0,le.S)(e.t0,(function(e,t){N(t||"formErrorMessage",{type:"manual",message:e})}));case 25:return e.prev=25,x(!1),e.finish(25);case 28:case"end":return e.stop()}}),e,null,[[3,22,25,28]])})));return function(t){return e.apply(this,arguments)}}();return(0,pe.tZ)("form",{onChange:function(){L("formErrorMessage")},onSubmit:P(A)},(0,pe.tZ)(ce.B,{errors:E,name:"formErrorMessage",render:function(e){var t=e.message;return(0,pe.tZ)(c.bZ,{status:"error",mb:3},(0,pe.tZ)(c.zM,null),(0,pe.tZ)(q.h1,null,t))}}),(0,pe.tZ)(te.NI,{id:"projectName",isRequired:!0,isInvalid:!!E.projectName,mb:3},(0,pe.tZ)(re.l,null,"Nom du projet"),(0,pe.tZ)(Pe.I,{name:"projectName",placeholder:"Nom du projet",ref:C({required:"Veuillez saisir le nom du projet"}),defaultValue:n.project&&n.project.projectName}),(0,pe.tZ)(ne.J,null,(0,pe.tZ)(ce.B,{errors:E,name:"projectName"}))),(0,pe.tZ)(te.NI,{id:"projectDescription",isInvalid:!!E.projectDescription,mb:3},(0,pe.tZ)(re.l,null,"Description du projet"),(0,pe.tZ)(ue.Qr,{name:"projectDescription",control:I,defaultValue:"",render:function(e){var t;return(0,pe.tZ)(q.Qd,{defaultValue:null===(t=n.project)||void 0===t?void 0:t.projectDescription,onChange:function(t){e.onChange("<p><br></p>"===t?"":t)},placeholder:"Description du projet"})}}),(0,pe.tZ)(ne.J,null,(0,pe.tZ)(ce.B,{errors:E,name:"projectDescription"}))),D.length>0&&(0,pe.tZ)(te.NI,{id:"projectStatus",isRequired:!0,isInvalid:!!E.projectStatus,mb:3},(0,pe.tZ)(re.l,null,"Statut"),(0,pe.tZ)(Ct.Ph,{name:"projectStatus",defaultValue:Ot.qb[Ot.qb.PENDING],ref:C({required:"Veuillez s\xe9lectionner le statut du projet"}),placeholder:"S\xe9lectionnez le statut du projet...",color:"gray.400"},D.map((function(e){return(0,pe.tZ)("option",{key:e,value:e},Ot.cZ[e])}))),(0,pe.tZ)(ne.J,null,(0,pe.tZ)(ce.B,{errors:E,name:"projectStatus"}))),T.length>0&&(0,pe.tZ)(te.NI,{id:"projectVisibility",isRequired:!0,isInvalid:!!E.projectVisibility,mb:3},(0,pe.tZ)(re.l,null,"Visibilit\xe9"),(0,pe.tZ)(Ct.Ph,{name:"projectVisibility",defaultValue:Ot.Hk[Ot.Hk.PUBLIC],ref:C({required:"Veuillez s\xe9lectionner la visibilit\xe9 du projet"}),placeholder:"S\xe9lectionnez la visibilit\xe9 du projet...",color:"gray.400"},T.map((function(e){return(0,pe.tZ)("option",{key:e,value:e},Ot.XO[e])}))),(0,pe.tZ)(ne.J,null,(0,pe.tZ)(ce.B,{errors:E,name:"projectVisibility"}))),(0,pe.tZ)(te.NI,{mb:3,id:"projectOrgs",isInvalid:!!E.projectOrgs,isRequired:V.required},(0,pe.tZ)(re.l,null,"Organisateurs"),(0,pe.tZ)(ue.Qr,{name:"projectOrgs",rules:V,as:It.ZP,control:I,defaultValue:(null===(t=n.project)||void 0===t?void 0:t.projectOrgs)||[r],placeholder:"S\xe9lectionner...",menuPlacement:"top",isClearable:!0,isMulti:!0,isSearchable:!0,closeMenuOnSelect:!0,styles:{placeholder:function(){return{color:"#A0AEC0"}},control:function(e){return Lt(Lt({},e),{},{borderColor:"#e2e8f0",paddingLeft:"8px"})}},className:"react-select-container",classNamePrefix:"react-select",options:w,getOptionLabel:function(e){return"".concat(e.orgName)},getOptionValue:function(e){return e._id},onChange:function(e){return(0,v.Z)(e,1)[0]._id}}),(0,pe.tZ)(ne.J,null,(0,pe.tZ)(ce.B,{errors:E,name:"projectOrgs"}))),(0,pe.tZ)(j.k,{justifyContent:"space-between"},(0,pe.tZ)(je.z,{onClick:function(){return n.onCancel&&n.onCancel()}},"Annuler"),(0,pe.tZ)(je.z,{colorScheme:"green",type:"submit",isLoading:y||f.isLoading||Z.isLoading,isDisabled:Object.keys(E).length>0,"data-cy":"addProject"},n.project?"Modifier":"Ajouter")))},Dt=function(e){var t=(0,St.q)({defaultIsOpen:!0}),r=t.isOpen,n=(t.onOpen,t.onClose);return(0,pe.tZ)(jt.u_,{isOpen:r,onClose:function(){e.onClose&&e.onClose(),n()},closeOnOverlayClick:!1},(0,pe.tZ)(jt.ZA,null,(0,pe.tZ)(jt.hz,null,(0,pe.tZ)(jt.xB,null,e.project?"Modifier le projet":"Ajouter un projet"),(0,pe.tZ)(jt.ol,null),(0,pe.tZ)(jt.fe,null,(0,pe.tZ)(zt,e)))))},Tt=function(e){var t=e.project,r=e.orgQuery,n=(0,R.k)(),o=n.data,i=(n.loading,(0,S.useToast)({position:"top"})),u=(0,Le.TL)(),c=(0,Pt.KT)(),d=(0,v.Z)(c,2),p=d[0],g=d[1],m=(0,f.v9)(Ee.I_)||(null===o||void 0===o?void 0:o.user.email)||"",b=function(){var e=(0,s.Z)(a().mark((function e(){var n,s,l,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=null,o||m&&""!==m){e.next=7;break}if((s=prompt("Veuillez entrer votre adresse e-mail :"))&&ze.GN.test(s)){e.next=6;break}return i({status:"error",title:"Adresse e-mail invalide"}),e.abrupt("return");case 6:u((0,Ee.WG)(s));case 7:if(!(0,Ot.po)({email:s||m,project:t})){e.next=10;break}return i({status:"error",title:"Vous participez d\xe9j\xe0 \xe0 cet projet"}),e.abrupt("return");case 10:return l=!0,c=(null===(n=t.projectNotified)||void 0===n?void 0:n.map((function(e){var t=e.email,r=e.status;return t!==s&&!m||r===Ot.Sk.OK?{email:t,status:r}:(l=!1,{email:t,status:Ot.Sk.OK})})))||[],l&&(null===c||void 0===c||c.push({email:s||m,status:Ot.Sk.OK})),e.next=15,p({payload:{projectNotified:c},projectId:t._id});case 15:r.refetch();case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Z=function(){var e=(0,s.Z)(a().mark((function e(){var n,s,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=null,o||m&&""!==m){e.next=7;break}if((s=prompt("Veuillez entrer votre adresse e-mail :"))&&ze.GN.test(s)){e.next=6;break}return i({status:"error",title:"Adresse e-mail invalide"}),e.abrupt("return");case 6:u((0,Ee.WG)(s));case 7:return l=null===(n=t.projectNotified)||void 0===n?void 0:n.filter((function(e){var t=e.email;e.status;return t!==s&&t!==m})),e.next=10,p({payload:{projectNotified:l},projectId:t._id});case 10:r.refetch();case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,pe.tZ)(I.xu,{p:3},(0,Ot.po)({email:m,project:t})?(0,pe.tZ)(q.zx,{colorScheme:"red",isLoading:g.isLoading||r.isFetching||r.isLoading,onClick:(0,s.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:confirm("\xcates-vous s\xfbr de ne plus vouloir participer \xe0 cet projet ?")&&Z();case 2:case"end":return e.stop()}}),e)})))},"Ne plus participer \xe0 ce projet"):g.isLoading||r.isFetching||r.isLoading?(0,pe.tZ)(l.$,null):(0,pe.tZ)(q.zx,{colorScheme:"green",onClick:b},"Participer \xe0 ce projet"))},Vt=r(36636),At=r(32379),Rt=r(33921),_t=function(e){var t=e.projectVisibility;return t===Rt.EE.SUBSCRIBERS?(0,pe.tZ)(z.u,{label:"Projet r\xe9serv\xe9 aux adh\xe9rents"},(0,pe.tZ)("span",null,(0,pe.tZ)(T.J,{as:At.h,boxSize:4}))):t===Rt.EE.FOLLOWERS?(0,pe.tZ)(z.u,{label:"Projet r\xe9serv\xe9 aux abonn\xe9s"},(0,pe.tZ)(we.L,{boxSize:4})):t===Rt.EE.PUBLIC?(0,pe.tZ)(z.u,{label:"Projet public"},(0,pe.tZ)("span",null,(0,pe.tZ)(T.J,{as:m.j,boxSize:4}))):null},Mt=function(e){var t=e.selectedStatuses,r=e.setSelectedStatuses,n=(0,u.Z)(e,["selectedStatuses","setSelectedStatuses"]),i="dark"===(0,S.useColorMode)().colorMode;return(0,pe.tZ)(j.k,(0,o.Z)({flexWrap:"nowrap",overflowX:"auto"},n),Object.keys(Ot.qb).map((function(e){var n=t.includes(e);return(0,pe.tZ)(Te.r,{key:"status-"+e,variant:"no-underline",onClick:function(){r(t.includes(e)?t.filter((function(t){return t!==e})):[e])}},(0,pe.tZ)(P.Vp,{variant:n?"solid":"outline",color:i||n?"white":"black",bgColor:n?i?"whiteAlpha.300":"blackAlpha.600":void 0,mr:1,whiteSpace:"nowrap"},Ot.cZ[e]))})))},Bt=[{key:"a-z",label:"A-Z",order:"asc"},{key:"z-a",label:"Z-A",order:"desc"}],Ut=function(e){e.selectedOrder;var t=e.setSelectedOrder,r=(0,u.Z)(e,["selectedOrder","setSelectedOrder"]);return(0,pe.tZ)(Ct.Ph,(0,o.Z)({placeholder:"Changer l'ordre d'affichage",width:"fit-content",onChange:function(e){t(Bt.find((function(t){return t.key===e.target.value})))}},r),Bt.map((function(e){var t=e.key,r=e.label,n=e.order;return(0,pe.tZ)("option",{key:t+"-"+n,value:t},r)})))};function Qt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function qt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Qt(Object(r),!0).forEach((function(t){(0,J.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ft=function(e){var t=e.org,r=e.orgQuery,n=e.isCreator,i=e.isFollowed,l=e.isSubscribed,c=e.isLogin,d=e.setIsLogin,f=(0,u.Z)(e,["org","orgQuery","isCreator","isFollowed","isSubscribed","isLogin","setIsLogin"]),g="dark"===(0,S.useColorMode)().colorMode,m=(0,R.k)(),b=m.data,Z=m.loading,h=(0,S.useToast)({position:"top"}),x=(0,Pt.ec)(),k=(0,v.Z)(x,2),w=k[0],O=(k[1],(0,p.useMemo)((function(){return(0,xt.Z)(t.orgProjects)}),[t])),j=(Array.isArray(t.orgProjects)&&t.orgProjects.length,(0,p.useState)({})),E=j[0],N=j[1],L=(0,p.useState)({isOpen:!1,project:void 0}),T=L[0],A=L[1],_=(0,p.useState)(null),M=_[0],B=_[1],U=(0,p.useState)([]),F=U[0],W=U[1],X=(0,p.useState)(),Y=X[0],K=X[1];return(0,pe.tZ)(p.Fragment,null,(0,pe.tZ)(je.z,{colorScheme:"teal",leftIcon:(0,pe.tZ)(ft.d,null),mb:5,onClick:function(){Z||(b?n||l?A(qt(qt({},T),{},{isOpen:!0})):h({status:"error",title:"Vous devez \xeatre adh\xe9rent ".concat((0,_e.rY)(t.orgType)," pour ajouter un projet")}):d(c+1))}},"Ajouter un projet"),(0,pe.tZ)(Mt,{selectedStatuses:F,setSelectedStatuses:W,mb:5}),(0,pe.tZ)(Ut,{selectedOrder:Y,setSelectedOrder:K,mb:5}),(0,pe.tZ)(q.rj,(0,o.Z)({"data-cy":"projectList"},f),r.isLoading||r.isFetching?(0,pe.tZ)(C.x,null,"Chargement des projets..."):O.sort((function(e,t){if(!Y)return 0;if("asc"===Y.order){if(e.projectName<t.projectName)return-1;if(e.projectName>t.projectName)return 1}else if("desc"===Y.order){if(e.projectName>t.projectName)return-1;if(e.projectName<t.projectName)return 1}return 0})).map((function(e,t){var n,o=e.projectName,i=e.projectDescription,u=e.projectStatus,l=e.createdBy,c=e.createdAt;if((0,We.t)(F)&&!F.includes(u))return null;var d="object"===typeof l?l.userName||(null===(n=l.email)||void 0===n?void 0:n.replace(/@.+/,"")):"",f=Vt.Sy(c,!0),m=f.timeAgo,v=f.fullDate,Z=M&&e._id===M._id,x="object"===typeof l?l._id===(null===b||void 0===b?void 0:b.user.userId):"",k=g?t%2===0?"gray.600":"gray.500":t%2===0?"orange.200":"orange.100";return(0,pe.tZ)(I.xu,{key:e._id,mb:5},(0,pe.tZ)(q.P4,{minWidth:"100%",p:3,borderTopRadius:"xl",borderBottomRadius:Z?void 0:"xl",light:{bg:k,_hover:{bg:"orange.300"}},dark:{bg:k,_hover:{bg:"gray.400"}}},(0,pe.tZ)(q.rU,{variant:"no-underline",onClick:function(){return B(Z?null:e)},"data-cy":"project"},(0,pe.tZ)(q.rj,{templateColumns:"auto auto 1fr auto"},(0,pe.tZ)(q.P4,{display:"flex",alignItems:"center",pr:3},M&&Z?(0,pe.tZ)(kt.O,{boxSize:6}):(0,pe.tZ)(wt.t,{boxSize:6})),(0,pe.tZ)(q.P4,{display:"flex",alignItems:"center",pr:3},(0,pe.tZ)(P.Vp,{variant:"solid",colorScheme:u===Ot.qb.PENDING?"red":u===Ot.qb.ONGOING?"orange":"green"},Ot.cZ[u])),(0,pe.tZ)(q.P4,null,(0,pe.tZ)(C.x,{fontWeight:"bold"},o),(0,pe.tZ)(I.xu,{display:"inline",fontSize:"smaller",color:g?"white":"gray.600"},d,(0,pe.tZ)("span",{"aria-hidden":!0}," \xb7 "),(0,pe.tZ)(z.u,{placement:"bottom",label:v},(0,pe.tZ)("span",null,m)),(0,pe.tZ)("span",{"aria-hidden":!0}," \xb7 "),(0,pe.tZ)(_t,{projectVisibility:e.projectVisibility}))),x&&(0,pe.tZ)(q.P4,{display:"flex",alignItems:"center"},(0,pe.tZ)(z.u,{label:"Modifier le projet"},(0,pe.tZ)(D.h,{"aria-label":"Modifier le projet",icon:(0,pe.tZ)(y.d,null),bg:"transparent",_hover:{bg:"transparent",color:"green"},height:"auto",minWidth:0,onClick:function(){A({isOpen:!0,project:e})}})),(0,pe.tZ)(I.xu,{"aria-hidden":!0,mx:1},"\xb7"),(0,pe.tZ)(q.m1,{isIconOnly:!0,isLoading:E[e._id],placement:"bottom",bg:"transparent",height:"auto",minWidth:0,_hover:{color:"red"},header:(0,pe.tZ)(p.Fragment,null,"\xcates vous s\xfbr de vouloir supprimer le projet",(0,pe.tZ)(C.x,{display:"inline",color:"red",fontWeight:"bold"}," ".concat(o))," ","?"),onClick:(0,s.Z)(a().mark((function t(){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(N((0,J.Z)({},e._id,!0)),t.prev=1,!e._id){t.next=6;break}return t.next=5,w(e._id).unwrap();case 5:n=t.sent;case 6:n&&(r.refetch(),h({title:"".concat(n.projectName," a bien \xe9t\xe9 supprim\xe9 !"),status:"success",isClosable:!0})),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(1),h({title:t.t0.data?t.t0.data.message:t.t0.message,status:"error",isClosable:!0});case 12:case"end":return t.stop()}}),t,null,[[1,9]])}))),"data-cy":"deleteTopic"}))))),Z&&(0,pe.tZ)(p.Fragment,null,(0,pe.tZ)(q.P4,{p:3,light:{bg:"white"},dark:{bg:"gray.700"}},i?(0,pe.tZ)(I.xu,{className:"ql-editor"},(0,pe.tZ)("div",{dangerouslySetInnerHTML:{__html:Q().sanitize(i)}})):x?(0,pe.tZ)(q.rU,{onClick:function(){A({isOpen:!0,project:e})},variant:"underline"},"Cliquez ici pour ajouter la description du projet."):(0,pe.tZ)(C.x,{fontStyle:"italic"},"Aucune description.")),(0,pe.tZ)(q.P4,{light:{bg:k},dark:{bg:k},overflowX:"auto",borderBottomRadius:"xl"},x?(0,pe.tZ)(V.iA,null,(0,pe.tZ)(V.p3,null,Array.isArray(e.projectNotified)&&e.projectNotified.length>0?e.projectNotified.map((function(e){var t=e.email,r=e.status;return(0,pe.tZ)(V.Tr,null,(0,pe.tZ)(V.Td,null,t),(0,pe.tZ)(V.Td,null,(0,pe.tZ)(P.Vp,{variant:"solid",colorScheme:r===Ot.Sk.PENDING?"blue":r===Ot.Sk.OK?"green":"red"},Ot.EE[r])))})):(0,pe.tZ)(V.Tr,null,(0,pe.tZ)(V.Td,null,(0,pe.tZ)(C.x,{fontStyle:"italic"},"Personne n'a indiqu\xe9 participer."))))):(0,pe.tZ)(Tt,{project:e,orgQuery:r}))))}))),T.isOpen&&b&&(0,pe.tZ)(Dt,{session:b,project:T.project,org:t,isCreator:n,isFollowed:i,isSubscribed:l,onCancel:function(){return A(qt(qt({},T),{},{isOpen:!1,project:void 0}))},onSubmit:function(){var e=(0,s.Z)(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.refetch(),A(qt(qt({},T),{},{isOpen:!1,project:void 0})),B(t||null);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onClose:function(){return A(qt(qt({},T),{},{isOpen:!1,project:void 0}))}}))},Wt=r(95088);function Jt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Xt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Jt(Object(r),!0).forEach((function(t){(0,J.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Yt=function(e){var t,r,n,o,i=e.org,l=e.orgQuery,d=e.isVisible,f=e.setIsVisible,g=(0,u.Z)(e,["org","orgQuery","isVisible","setIsVisible"]),m=(0,S.useToast)({position:"top"}),b=(0,p.useState)([{label:"Petit",height:140},{label:"Moyen",height:240},{label:"Grand",height:340}]),Z=b[0],h=(b[1],(0,p.useState)(null!==(t=i.orgBanner)&&void 0!==t&&t.url?"url":"local")),y=h[0],x=h[1],k=(0,p.useState)(null),C=k[0],P=k[1],E=(0,p.useRef)(null),N=(0,ue.cI)({mode:"onChange"}),z=N.register,D=N.control,T=N.handleSubmit,V=N.setError,A=N.errors,R=N.clearErrors,_=N.getValues,M=(N.setValue,N.watch),B=(null===(r=i.orgBanner)||void 0===r?void 0:r.height)||Z[0].height,U=M("height")||B,Q=(0,Et.iO)(),F=(0,v.Z)(Q,2),W=F[0],J=F[1],X=function(){var e=(0,s.Z)(a().mark((function e(t){var r,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("submitted",t),e.prev=1,r={},r="url"===y?{orgBanner:{url:t.url,height:t.height}}:{orgBanner:{height:t.height,mode:t.mode,base64:null===E||void 0===E||null===(n=E.current)||void 0===n?void 0:n.getImageScaledToCanvas().toDataURL()}},e.next=6,W({payload:r,orgUrl:i.orgUrl});case 6:m({title:"L'image de couverture a bien \xe9t\xe9 modifi\xe9e !",status:"success"}),l.refetch(),f(Xt(Xt({},d),{},{banner:!1})),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),(0,le.S)(e.t0,(function(e){return V("formErrorMessage",{type:"manual",message:e})}));case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}();return(0,pe.tZ)(q.rj,g,(0,pe.tZ)(q.rU,{variant:"no-underline",onClick:function(){return f(Xt(Xt({},d),{},{banner:!d.banner,logo:!1}))}},(0,pe.tZ)(q.Q1,{borderTopRadius:"lg",borderBottomRadius:d.banner?void 0:"lg",alignItems:"center"},(0,pe.tZ)(j.k,{flexDirection:"row",alignItems:"center"},d.banner?(0,pe.tZ)(w.v,null):(0,pe.tZ)(O.X,null),(0,pe.tZ)(L.X,{size:"sm",py:3},"Changer l'image de couverture")))),d.banner&&(0,pe.tZ)(q.P4,{light:{bg:"orange.100"},dark:{bg:"gray.500"}},(0,pe.tZ)(I.xu,{p:5},(0,pe.tZ)("form",{method:"post",onChange:function(){R("formErrorMessage")},onSubmit:T(X)},(0,pe.tZ)(ce.B,{errors:A,name:"formErrorMessage",render:function(e){var t=e.message;return(0,pe.tZ)(c.bZ,{status:"error",mb:3},(0,pe.tZ)(c.zM,null),(0,pe.tZ)(q.h1,null,t))}}),(0,pe.tZ)(H.E,{name:"uploadType",mb:3},(0,pe.tZ)($.Kq,{spacing:2},(0,pe.tZ)(ee.Y,{isChecked:"local"===y,onChange:function(){x("local")}},"Envoyer une image depuis votre ordinateur"),(0,pe.tZ)(ee.Y,{isChecked:"url"===y,onChange:function(){x("url")}},"Utiliser une image en provenance d'une autre adresse"))),(0,pe.tZ)(te.NI,{id:"height",mb:3},(0,pe.tZ)(re.l,null,"Hauteur"),(0,pe.tZ)(q.Ph,{name:"height",ref:z(),defaultValue:B},Z.map((function(e){var t=e.label,r=e.height;return(0,pe.tZ)("option",{key:"height-"+r,value:r},t)})))),"url"===y?(0,pe.tZ)(de.I,{name:"url",register:z,control:D,errors:A,label:"Adresse internet de l'image",defaultValue:null===(n=i.orgBanner)||void 0===n?void 0:n.url,isMultiple:!1}):(0,pe.tZ)(p.Fragment,null,(0,pe.tZ)(te.NI,{id:"file",isInvalid:!!A.file,mb:3},(0,pe.tZ)(re.l,null,"Image"),(0,pe.tZ)(q.II,{height:"auto",py:3,name:"file",type:"file",accept:"image/*",onChange:function(){var e=(0,s.Z)(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.target.files||!t.target.files[0]){e.next=8;break}if(!(t.target.files[0].size<1e6)){e.next=8;break}return e.t0=P,e.next=5,se(t.target.files[0]);case 5:e.t1=e.sent,(0,e.t0)(e.t1),R("file");case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ref:z({validate:function(e){return!(e&&e[0]&&e[0].size>=1e6)||"L'image ne doit pas d\xe9passer 1Mo."}})}),(0,pe.tZ)(ne.J,null,(0,pe.tZ)(ce.B,{errors:A,name:"file"})))),(0,pe.tZ)(I.xu,{mb:3},"url"===y?(0,pe.tZ)(oe.E,{src:_("url")||(null===(o=i.orgBanner)||void 0===o?void 0:o.url)}):C&&(0,pe.tZ)(G(),{ref:E,image:C,width:1154,height:parseInt(U),border:0,color:[255,255,255,.6],scale:1,rotate:0})),(0,pe.tZ)(q.zx,{colorScheme:"green",type:"submit",isLoading:J.isLoading,isDisabled:Object.keys(A).length>0},"Valider")))))},Kt=r(88853),Gt=r(2827),Ht=r(74616);function $t(e,t){var r;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"===typeof e)return er(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return er(e,t)}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}function er(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function tr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function rr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tr(Object(r),!0).forEach((function(t){(0,J.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var nr={name:"15zbsul",styles:"/*\n                  @media (max-width: 452px) {\n                    & > tr {\n                      td {\n                        padding: 0 12px 0 0;\n                      }\n\n                      td:first-of-type {\n                        padding: 4px 0 4px 4px;\n\n                        & > span:first-of-type {\n                          margin-bottom: 4px;\n                        }\n                      }\n                    }\n                  }\n\n                  @media (min-width: 453px) and (max-width: 604px) {\n                    & > tr {\n                      td:first-of-type {\n                        & > span:first-of-type {\n                          margin-bottom: 4px;\n                        }\n                      }\n                    }\n                  }\n                */"},or={name:"7sy4z5",styles:".chakra-checkbox__control{border-color:black;}"},ir={name:"12bhwe5",styles:"@media (max-width: 730px){&{grid-column:1;padding-bottom:12px;}}"},ar={name:"15qy8yo",styles:"@media (max-width: 730px){&{padding-top:12px;padding-bottom:12px;}}"},sr=function(e){var t=e.org,r=e.orgQuery,n=e.subQuery,o=e.isVisible,i=e.setIsVisible,u=((0,S.useColorMode)().colorMode,(0,d.useRouter)()),l=(0,S.useToast)({position:"top"}),f=(0,Le.TL)(),g=(0,De.h_)(),m=(0,v.Z)(g,2),b=m[0],Z=(m[1],(0,De.l_)()),h=(0,v.Z)(Z,2),y=h[0],x=(h[1],(0,ue.cI)({mode:"onChange"})),k=(x.control,x.register),E=x.handleSubmit,T=x.errors,A=x.setError,R=x.clearErrors,_=(x.watch,x.setValue),M=(x.getValues,x.trigger,(0,p.useState)(!1)),B=M[0],U=M[1],Q=(0,p.useState)(!1),F=Q[0],W=Q[1],X=(0,p.useState)(t.orgSubscriptions.reduce((function(e,t){return rr(rr({},e),{},(0,J.Z)({},t._id,!1))}),{})),Y=X[0],K=X[1],G=function(){var e=(0,s.Z)(a().mark((function e(o){var i,s,u,l,c,d,p,f;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=o.type,s=o.following,u=o.subscribing,l=o.email,c=o.phone,d=o.user,p=o.subscription,!Y[p._id]){e.next=3;break}return e.abrupt("return");case 3:if(K(rr(rr({},Y),{},(0,J.Z)({},p._id,!0))),f="object"===typeof d?d.email:l,i!==Ne.NY.FOLLOWER){e.next=19;break}if(!s){e.next=14;break}if(!confirm("\xcates vous s\xfbr de vouloir retirer ".concat(f," de la liste des abonn\xe9s ").concat((0,_e.rY)(t.orgType)," ").concat(t.orgName," ?"))){e.next=12;break}return e.next=11,y({subscriptionId:p._id,payload:{orgs:[s]}});case 11:r.refetch();case 12:e.next=17;break;case 14:return e.next=16,b({email:l,phone:c,user:d,payload:{orgs:[{orgId:t._id,org:t,type:Ne.NY.FOLLOWER}]}});case 16:r.refetch();case 17:e.next=32;break;case 19:if(i!==Ne.NY.SUBSCRIBER){e.next=32;break}if(!u){e.next=29;break}if(!confirm("\xcates vous s\xfbr de vouloir retirer ".concat(f," de la liste des adh\xe9rents ").concat((0,_e.rY)(t.orgType)," ").concat(t.orgName," ?"))){e.next=27;break}return e.next=25,y({subscriptionId:p._id,payload:{orgs:[u]}});case 25:r.refetch(),n.refetch();case 27:e.next=32;break;case 29:return e.next=31,b({email:l,phone:c,user:d,payload:{orgs:[{orgId:t._id,org:t,type:Ne.NY.SUBSCRIBER}]}});case 31:r.refetch();case 32:K(rr(rr({},Y),{},(0,J.Z)({},p._id,!1)));case 33:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),H=function(){var e=(0,s.Z)(a().mark((function e(s){var u,l,c,d,p,g,m,v,Z,h,y,x,k,w,O,S,j;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,W(!0),console.log("submitted",s),u=s.emailList,l=s.phoneList,c=s.subscriptionType,d=u.split(/(\s+)/).filter((function(e){return e.trim().length>0})).filter((function(e){return ze.GN.test(e)})),p=l.split(/(\s+)/).filter((function(e){return e.trim().length>0})).filter((function(e){return vt.S9.test(e)})),d.length||p.length){e.next=8;break}throw new Error("Aucune coordonn\xe9e valide");case 8:g=$t(d),e.prev=9,g.s();case 11:if((m=g.n()).done){e.next=32;break}v=m.value,Z=$t(c),e.prev=14,Z.s();case 16:if((h=Z.n()).done){e.next=22;break}return y=h.value,e.next=20,b({email:v,payload:{orgs:[{orgId:t._id,org:t,type:y}]}});case 20:e.next=16;break;case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(14),Z.e(e.t0);case 27:return e.prev=27,Z.f(),e.finish(27);case 30:e.next=11;break;case 32:e.next=37;break;case 34:e.prev=34,e.t1=e.catch(9),g.e(e.t1);case 37:return e.prev=37,g.f(),e.finish(37);case 40:x=$t(p),e.prev=41,x.s();case 43:if((k=x.n()).done){e.next=64;break}w=k.value,O=$t(c),e.prev=46,O.s();case 48:if((S=O.n()).done){e.next=54;break}return j=S.value,e.next=52,b({phone:w,payload:{orgs:[{orgId:t._id,org:t,type:j}]}});case 52:e.next=48;break;case 54:e.next=59;break;case 56:e.prev=56,e.t2=e.catch(46),O.e(e.t2);case 59:return e.prev=59,O.f(),e.finish(59);case 62:e.next=43;break;case 64:e.next=69;break;case 66:e.prev=66,e.t3=e.catch(41),x.e(e.t3);case 69:return e.prev=69,x.f(),e.finish(69);case 72:i(rr(rr({},o),{},{subscribers:!0})),U(!1),r.refetch(),n.refetch(),f((0,rt.pK)()),e.next=82;break;case 79:e.prev=79,e.t4=e.catch(0),(0,le.S)(e.t4,(function(e,t){A(t||"formErrorMessage",{type:"manual",message:e})}));case 82:return e.prev=82,W(!1),e.finish(82);case 85:case"end":return e.stop()}}),e,null,[[0,79,82,85],[9,34,37,40],[14,24,27,30],[41,66,69,72],[46,56,59,62]])})));return function(t){return e.apply(this,arguments)}}();return(0,pe.tZ)(N.r,null,(0,pe.tZ)(q.rU,{variant:"no-underline",onClick:function(){(0,We.t)(t.orgSubscriptions)?(U(!1),i(rr(rr({},o),{},{subscribers:!o.subscribers,banner:!1}))):U(!0)}},(0,pe.tZ)(q.Q1,{borderTopRadius:"lg",borderBottomRadius:o.subscribers?void 0:"lg"},(0,pe.tZ)(N.r,{templateColumns:"1fr auto",alignItems:"center"},(0,pe.tZ)(q.P4,{css:ar},(0,pe.tZ)(j.k,{flexDirection:"row",alignItems:"center"},o.subscribers?(0,pe.tZ)(w.v,null):(0,pe.tZ)(O.X,null),(0,pe.tZ)(L.X,{size:"sm"},"Adh\xe9rents & Abonn\xe9s"))),(0,pe.tZ)(q.P4,{css:ir},(0,pe.tZ)(je.z,{rightIcon:B?(0,pe.tZ)(w.v,null):(0,pe.tZ)(O.X,null),colorScheme:B?"green":"teal",onClick:function(e){e.stopPropagation(),R(),_("subscriptionType",[]),U(!B),i(rr(rr({},o),{},{subscribers:!1}))},m:1,"data-cy":"orgAddSubscribers"},"Ajouter des coordonn\xe9es"))))),B&&(0,pe.tZ)(q.P4,{light:{bg:"orange.50"},dark:{bg:"gray.700"},p:5},(0,pe.tZ)("form",{onChange:function(){return R("formErrorMessage")},onSubmit:E(H)},(0,pe.tZ)(te.NI,{id:"emailList",isInvalid:!!T.emailList,mb:3},(0,pe.tZ)(re.l,null,"Entrez les e-mails s\xe9par\xe9es par un espace ou un retour \xe0 la ligne :"," "),(0,pe.tZ)(q.gx,{ref:k(),name:"emailList",dark:{_hover:{borderColor:"white"}}}),(0,pe.tZ)(ne.J,null,(0,pe.tZ)(ce.B,{errors:T,name:"emailList"}))),(0,pe.tZ)(te.NI,{id:"phoneList",isInvalid:!!T.phoneList,mb:3},(0,pe.tZ)(re.l,null,"Entrez les num\xe9ros de t\xe9l\xe9phone mobile s\xe9par\xe9s par un espace ou un retour \xe0 la ligne :"," "),(0,pe.tZ)(q.gx,{ref:k(),name:"phoneList",dark:{_hover:{borderColor:"white"}}}),(0,pe.tZ)(ne.J,null,(0,pe.tZ)(ce.B,{errors:T,name:"phoneList"}))),(0,pe.tZ)(te.NI,{id:"subscriptionType",isRequired:!0,isInvalid:!!T.subscriptionType,mb:3},(0,pe.tZ)(re.l,null,"Ajouter les coordonn\xe9es en tant que :"),(0,pe.tZ)(Ae.c,null,(0,pe.tZ)(I.xu,{display:"flex",flexDirection:"column",css:or,color:"black"},(0,pe.tZ)(Re.X,{ref:k({required:!0}),name:"subscriptionType",value:Ne.NY.SUBSCRIBER,bg:"purple.100",borderRadius:"lg",p:3,mb:3},"Adh\xe9rent",(0,pe.tZ)(C.x,{fontSize:"smaller"},"La personne aura acc\xe8s aux discussions et \xe9v\xe9nements r\xe9serv\xe9es aux adh\xe9rents.")),(0,pe.tZ)(Re.X,{ref:k({required:!0}),name:"subscriptionType",value:Ne.NY.FOLLOWER,bg:"green.100",borderRadius:"lg",p:3},"Abonn\xe9",(0,pe.tZ)(C.x,{fontSize:"smaller"},"La personne recevra les e-mails d'invitation aux \xe9v\xe9nements.")))),(0,pe.tZ)(ne.J,null,(0,pe.tZ)(ce.B,{errors:T,name:"subscriptionType",message:"Veuillez cocher une case au minimum"}))),(0,pe.tZ)(ce.B,{errors:T,name:"formErrorMessage",render:function(e){var t=e.message;return(0,pe.tZ)(c.bZ,{status:"error",mb:3},(0,pe.tZ)(c.zM,null),(0,pe.tZ)(q.h1,null,t))}}),(0,pe.tZ)(j.k,null,(0,pe.tZ)(je.z,{onClick:function(){return U(!1)},mr:3},"Annuler"),(0,pe.tZ)(je.z,{colorScheme:"green",type:"submit",isDisabled:Object.keys(T).length>0||Object.keys(Y).some((function(e){return!!Y[e]})),isLoading:F,"data-cy":"orgAddSubscribersSubmit"},"Ajouter")))),o.subscribers&&(r.isLoading?(0,pe.tZ)(C.x,null,"Chargement de la liste des adh\xe9rents & abonn\xe9s..."):(0,pe.tZ)(q.P4,{light:{bg:"orange.100"},dark:{bg:"gray.500"},overflowX:"auto","aria-hidden":!0},(0,pe.tZ)(V.iA,null,(0,pe.tZ)(V.p3,{css:nr},t.orgSubscriptions.map((function(e,o){var i,c,d=e.email,p=e.phone,g=e.user,m=e.orgs,b=void 0===m?[]:m;"object"===typeof g&&(i=g.email,c=g.userName);var v,Z=null,h=null,x=$t(b);try{for(x.s();!(v=x.n()).done;){var k=v.value,w=k.type;k.orgId===t._id&&w&&(w===Ne.NY.FOLLOWER?Z=k:w===Ne.NY.SUBSCRIBER&&(h=k))}}catch(O){x.e(O)}finally{x.f()}return(0,pe.tZ)(V.Tr,{key:"email-".concat(o)},(0,pe.tZ)(V.Td,{whiteSpace:"nowrap"},(0,pe.tZ)(q.rU,{variant:"no-underline",onClick:function(){return G({type:Ne.NY.FOLLOWER,following:Z,email:d,phone:p,user:g,subscription:e})},"data-cy":Z?"orgSubscriberUnfollow":"orgSubscriberFollow"},(0,pe.tZ)(z.u,{placement:"top",hasArrow:!0,label:"".concat(Z?"Retirer de":"Ajouter \xe0"," la liste des abonn\xe9s")},(0,pe.tZ)(P.Vp,{variant:Z?"solid":"outline",colorScheme:"green",mr:3},(0,pe.tZ)(P.Sn,null,"Abonn\xe9")))),(0,pe.tZ)(q.rU,{variant:"no-underline",onClick:function(){return G({type:Ne.NY.SUBSCRIBER,subscribing:h,email:d,phone:p,user:g,subscription:e})},"data-cy":h?"orgSubscriberUnsubscribe":"orgSubscriberSubscribe"},(0,pe.tZ)(z.u,{placement:"top",hasArrow:!0,label:"".concat(h?"Retirer de":"Ajouter \xe0"," la liste des adh\xe9rents")},(0,pe.tZ)(P.Vp,{variant:h?"solid":"outline",colorScheme:"purple",mr:3},(0,pe.tZ)(P.Sn,null,"Adh\xe9rent"))))),(0,pe.tZ)(V.Td,{width:"100%"},p||d||i),(0,pe.tZ)(V.Td,{whiteSpace:"nowrap",textAlign:"right"},(0,pe.tZ)(z.u,{label:"Aller \xe0 la page de l'utilisateur",hasArrow:!0,placement:"top"},(0,pe.tZ)(D.h,{"aria-label":"Aller \xe0 la page de l'utilisateur",bg:"transparent",_hover:{bg:"transparent",color:"green"},icon:(0,pe.tZ)(Kt.j,null),isLoading:Y[e._id],height:"auto",cursor:Y[e._id]?"not-allowed":void 0,onClick:(0,s.Z)(a().mark((function t(){var r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(K(rr(rr({},Y),{},(0,J.Z)({},e._id,!0))),!c){t.next=6;break}K(rr(rr({},Y),{},(0,J.Z)({},e._id,!1))),u.push("/".concat(c),"/".concat(c),{shallow:!0}),t.next=10;break;case 6:return t.next=8,f(Ht.PR.initiate(p||d||""));case 8:(r=t.sent).data?(K(rr(rr({},Y),{},(0,J.Z)({},e._id,!1))),u.push("/".concat(r.data.userName),"/".concat(r.data.userName),{shallow:!0})):(K(rr(rr({},Y),{},(0,J.Z)({},e._id,!1))),l({status:"warning",title:"Aucun utilisateur associ\xe9 \xe0 ".concat(p?"ce num\xe9ro de t\xe9l\xe9phone":"cette adresse-email")}));case 10:case"end":return t.stop()}}),t)})))})),(0,pe.tZ)(z.u,{label:"Supprimer de la liste",hasArrow:!0,placement:"top"},(0,pe.tZ)(D.h,{"aria-label":"D\xe9sinscrire",bg:"transparent",_hover:{bg:"transparent",color:"red"},icon:(0,pe.tZ)(Gt.p,null),isLoading:Y[e._id],height:"auto",minWidth:0,cursor:Y[e._id]?"not-allowed":void 0,onClick:(0,s.Z)(a().mark((function o(){return a().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(K(rr(rr({},Y),{},(0,J.Z)({},e._id,!0))),!confirm("\xcates-vous s\xfbr de vouloir supprimer l'abonnement ".concat(i||e.phone," de ").concat((0,_e.rY)(t.orgType)," ").concat(t.orgName," ?"))){o.next=8;break}return o.next=5,y({subscriptionId:e._id,orgId:t._id});case 5:f((0,rt.pK)()),r.refetch(),n.refetch();case 8:K(rr(rr({},Y),{},(0,J.Z)({},e._id,!1)));case 9:case"end":return o.stop()}}),o)}))),"data-cy":"orgUnsubscribe"}))))})))))))};function ur(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function lr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ur(Object(r),!0).forEach((function(t){(0,J.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ur(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var cr=function(e){var t=e.org,r=e.orgQuery,n=e.isVisible,o=e.setIsVisible,i=(0,u.Z)(e,["org","orgQuery","isVisible","setIsVisible"]),l=(0,S.useToast)({position:"top"}),d=(0,Et.iO)(),f=(0,v.Z)(d,2),g=f[0],m=f[1],b=(0,ue.cI)({mode:"onChange"}),Z=b.register,h=b.handleSubmit,y=b.setError,x=b.errors,k=b.clearErrors,C=(b.watch,(0,p.useState)()),P=C[0],E=C[1],z=(0,p.useRef)(null),D=function(){var e=(0,s.Z)(a().mark((function e(i){var s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("submitted",i),e.prev=1,e.next=4,g({payload:lr(lr({},t),{},{orgLogo:{width:220,height:220,base64:null===z||void 0===z||null===(s=z.current)||void 0===s?void 0:s.getImageScaledToCanvas().toDataURL()}}),orgUrl:t.orgUrl});case 4:l({title:"Le logo ".concat((0,_e.rY)(t.orgType)," a bien \xe9t\xe9 modifi\xe9 !"),status:"success"}),r.refetch(),o(lr(lr({},n),{},{banner:!1})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),(0,le.S)(e.t0,(function(e){return y("formErrorMessage",{type:"manual",message:e})}));case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}();return(0,pe.tZ)(N.r,i,(0,pe.tZ)(q.rU,{variant:"no-underline",onClick:function(){return o(lr(lr({},n),{},{logo:!n.logo,banner:!1,subscribers:!1}))}},(0,pe.tZ)(q.Q1,{borderTopRadius:"lg",borderBottomRadius:n.logo?void 0:"lg",alignItems:"center"},(0,pe.tZ)(j.k,{flexDirection:"row",alignItems:"center"},n.logo?(0,pe.tZ)(w.v,null):(0,pe.tZ)(O.X,null),(0,pe.tZ)(L.X,{size:"sm",py:3},"Changer le logo")))),n.logo&&(0,pe.tZ)(q.P4,{light:{bg:"orange.100"},dark:{bg:"gray.500"}},(0,pe.tZ)(I.xu,{p:5},(0,pe.tZ)("form",{method:"post",onChange:function(){k("formErrorMessage")},onSubmit:h(D)},(0,pe.tZ)(ce.B,{errors:x,name:"formErrorMessage",render:function(e){var t=e.message;return(0,pe.tZ)(c.bZ,{status:"error",mb:3},(0,pe.tZ)(c.zM,null),(0,pe.tZ)(q.h1,null,t))}}),(0,pe.tZ)(te.NI,{id:"file",isInvalid:!!x.file,mb:3},(0,pe.tZ)(re.l,null,"Image"),(0,pe.tZ)(q.II,{height:"auto",py:3,name:"file",type:"file",accept:"image/*",onChange:function(){var e=(0,s.Z)(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.target.files||!t.target.files[0]){e.next=8;break}if(!(t.target.files[0].size<1e6)){e.next=8;break}return e.t0=E,e.next=5,se(t.target.files[0]);case 5:e.t1=e.sent,(0,e.t0)(e.t1),k("file");case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ref:Z({validate:function(e){return!(e&&e[0]&&e[0].size>=1e6)||"L'image ne doit pas d\xe9passer 1Mo."}})}),(0,pe.tZ)(ne.J,null,(0,pe.tZ)(ce.B,{errors:x,name:"file"}))),P&&(0,pe.tZ)(G(),{ref:z,image:P,width:220,height:220,border:0,color:[255,255,255,.6],scale:1,rotate:0,style:{marginBottom:"12px"}}),(0,pe.tZ)(q.zx,{colorScheme:"green",type:"submit",isLoading:m.isLoading,isDisabled:Object.keys(x).length>0},"Valider")))))};function dr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function pr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?dr(Object(r),!0).forEach((function(t){(0,J.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var fr={name:"1vkc4pg",styles:"&:hover{--tw-bg-opacity:1;background-color:rgba(110, 231, 183, var(--tw-bg-opacity));;}"},gr=function(e){var t=e.session,r=e.org,n=e.orgQuery,o=e.subQuery,i=(e.isConfig,e.isEdit),u=e.isVisible,l=e.setIsConfig,c=e.setIsEdit,f=e.setIsVisible,g=(0,d.useRouter)(),m=(0,S.useToast)({position:"top"}),b=(0,Et.Xt)(),Z=(0,v.Z)(b,2),x=Z[0],k=Z[1],w=(0,p.useState)(!0),O=w[0],j=w[1],P=(0,p.useState)();P[0],P[1];return(0,pe.tZ)(p.Fragment,null,(0,pe.tZ)(I.xu,{mb:3},!i&&(0,pe.tZ)(p.Fragment,null,(0,pe.tZ)(q.zx,{"aria-label":"Modifier",leftIcon:(0,pe.tZ)(T.J,{as:i?h.R:y.d}),mr:3,onClick:function(){c(!i),f(pr(pr({},u),{},{banner:!1,subscribers:!1}))},css:fr,"data-cy":"orgEdit"},"Modifier"),(0,pe.tZ)(q.m1,{isDisabled:O,isLoading:k.isLoading,header:(0,pe.tZ)(p.Fragment,null,"Vous \xeates sur le point de supprimer l'organisation",(0,pe.tZ)(C.x,{display:"inline",color:"red",fontWeight:"bold"}," ".concat(r.orgName))),body:(0,pe.tZ)(p.Fragment,null,"Saisissez le nom de l'organisation pour confimer sa suppression :",(0,pe.tZ)(q.II,{autoComplete:"off",onChange:function(e){return j(e.target.value!==r.orgName)}})),onClick:(0,s.Z)(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,x(r.orgUrl).unwrap();case 3:if(!(t=e.sent)){e.next=8;break}return e.next=7,g.push("/");case 7:m({title:"".concat(t.orgName," a bien \xe9t\xe9 supprim\xe9 !"),status:"success",isClosable:!0});case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),m({title:e.t0.data?e.t0.data.message:e.t0.message,status:"error",isClosable:!0});case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))}))),i?(0,pe.tZ)(Wt.f,{session:t,org:r,onCancel:function(){return c(!1)},onSubmit:function(){var e=(0,s.Z)(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r||t===r.orgUrl){e.next=5;break}return e.next=3,g.push("/".concat(t));case 3:e.next=8;break;case 5:n.refetch(),c(!1),l(!1);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}):(0,pe.tZ)(p.Fragment,null,(0,pe.tZ)(cr,{org:r,orgQuery:n,isVisible:u,setIsVisible:f,mb:3}),(0,pe.tZ)(Yt,{org:r,orgQuery:n,isVisible:u,setIsVisible:f,mb:3}),(0,pe.tZ)(sr,{org:r,orgQuery:n,subQuery:o,isVisible:u,setIsVisible:f})))},mr=r(92472),br=r(93863),vr=r(68718);var Zr={name:"1utmw3m",styles:"-webkit-overflow-scrolling:touch;-ms-overflow-style:-ms-autohiding-scrollbar"},hr=function(e){var t=e.children,r=((0,u.Z)(e,["children"]),(0,S.chakra)("button",{themeKey:"Tabs.Tab"})),n=(0,S.useColorModeValue)("gray.100","whiteAlpha.300"),i=(0,p.useState)(0),a=i[0],s=i[1],l=p.forwardRef((function(e,t){var i=e.icon,s=e.tabIndex,l=(0,u.Z)(e,["icon","tabIndex"]),c=(0,Ge.xD)(l);c.tabIndex=0,a===s&&(c["aria-selected"]=!0);var d=(0,S.useStyles)();return(0,pe.tZ)(r,(0,o.Z)({display:"flex",flex:He.tq?"0 0 auto":"1",alignItems:"center",justifyContent:"center",bg:n,mx:1,_focus:{boxShadow:"none"}},c,{__css:d.tab}),(0,pe.tZ)("span",{style:{display:"inline-flex",flexShrink:"0",marginInlineEnd:"0.5rem"}},(0,pe.tZ)(T.J,{as:i,boxSize:5,verticalAlign:"middle"})),c.children)}));return(0,pe.tZ)(E.mQ,{defaultIndex:0,index:a,onChange:function(e){return s(e)},isFitted:!0,variant:"solid-rounded",borderWidth:1,borderColor:"gray.200",borderRadius:"lg",isManual:!0,isLazy:!0,lazyBehavior:"keepMounted"},(0,pe.tZ)(E.td,{as:"nav",display:"flex",flexWrap:"nowrap",alignItems:"center",height:"60px",overflowX:"auto",mx:3,css:Zr,"aria-hidden":!0},[{name:"Accueil",icon:Ke.x},{name:"\xc9v\xe9nements",icon:vr.Q},{name:"Projets",icon:br.C},{name:"Discussions",icon:$e.k},{name:"Galerie",icon:mr.J}].map((function(e,t){var r=e.name,n=e.icon;return(0,pe.tZ)(l,{key:"orgTab-".concat(t),tabIndex:t,icon:n,"data-cy":"orgTab-".concat(r)},r)}))),t)},yr=r(81442);var xr,kr=!1,wr=!1,Or={name:"vs73z9",styles:"@media (max-width: 650px){&{grid-template-columns:1fr!important;}}"},Sr=function(e){var t,r,n,o=e.populate,i=(0,u.Z)(e,["populate"]),a=(0,d.useRouter)(),s=(0,R.k)(),l=s.data,g=(s.loading,l||i.session),w=((0,S.useToast)({position:"top"}),(0,f.v9)(Ee.I_)||(null===g||void 0===g?void 0:g.user.email)),O=(0,Et.iA)({orgUrl:i.org.orgUrl,populate:o},{selectFromResult:function(e){return e}}),P=O.data||i.org,V=(0,f.v9)(yr.s$);(0,p.useEffect)((function(){V!==kr&&(kr=V,console.log("refetching org"),O.refetch())}),[V]),(0,p.useEffect)((function(){w!==xr&&(xr=w,console.log("refetching org with new email",w),O.refetch())}),[w]),(0,p.useEffect)((function(){console.log("refetching org with new route",a.asPath),O.refetch(),de(!1)}),[a.asPath]);var U="object"===typeof P.createdBy?P.createdBy.userName||P.createdBy._id:"",J="object"===typeof P.createdBy?P.createdBy._id:"",X=(null===g||void 0===g?void 0:g.user.userId)===J||(null===g||void 0===g?void 0:g.user.isAdmin),Y=P.orgEvents.filter((function(e){return e.eventVisibility===A.Hk.PUBLIC})),K=(0,De.h_)(),G=(0,v.Z)(K,2),H=(G[0],G[1],(0,De.xu)(w)),$=(0,f.v9)(qe.di);(0,p.useEffect)((function(){$!==wr&&(wr=$,console.log("refetching subscription"),H.refetch())}),[$]),(0,p.useEffect)((function(){w!==xr&&(xr=w,console.log("refetching subscription with new email",w),H.refetch())}),[w]);var ee=(0,qe.C3)({org:P,subQuery:H}),te=(0,qe.eM)(P,H),re=(0,p.useState)(!1),ne=(re[0],re[1],(0,p.useState)(0)),oe=ne[0],ie=ne[1],ae=(0,p.useState)(!1),se=ae[0],ue=ae[1],le=(0,p.useState)(!1),ce=le[0],de=le[1],fe=(0,p.useState)({logo:!1,banner:!1,topics:!1,subscribers:!1}),ge=fe[0],me=fe[1];return(0,pe.tZ)(W.Ar,{org:P,isLogin:oe,session:i.session},X&&!se?(0,pe.tZ)(q.zx,{colorScheme:"teal",leftIcon:(0,pe.tZ)(Z.e,{boxSize:6,"data-cy":"orgSettings"}),onClick:function(){return ue(!0)},mb:2},"Param\xe8tres ",(0,_e.rY)(P.orgType)):se&&!ce?(0,pe.tZ)(q.zx,{colorScheme:"pink",leftIcon:(0,pe.tZ)(h.R,{boxSize:6}),onClick:function(){return ue(!1)},mb:2},"Revenir ".concat((0,_e.pP)(P.orgType))):null,!H.isLoading&&!se&&(0,pe.tZ)(j.k,{flexDirection:"row",flexWrap:"wrap",mt:-3},ee&&(0,pe.tZ)(I.xu,{mr:3,mt:3},(0,pe.tZ)(Qe,{org:P,query:O,subQuery:H,followerSubscription:ee})),(0,pe.tZ)(I.xu,{mt:3},(0,pe.tZ)(Qe,{org:P,query:O,subQuery:H,followerSubscription:ee,notifType:"push"}))),(0,pe.tZ)(I.xu,{my:3},(0,pe.tZ)(C.x,{fontSize:"smaller"},"Organisation ajout\xe9e le"," ",(0,_.default)((0,M.default)(P.createdAt),"eeee d MMMM yyyy",{locale:B.Z})," ","par :"," ",(0,pe.tZ)(q.rU,{variant:"underline",href:"/".concat(U)},U)," ",X&&!(null!==g&&void 0!==g&&g.user.isAdmin)&&"(Vous)")),te&&!se&&(0,pe.tZ)(c.bZ,{status:"info",mb:3},(0,pe.tZ)(c.zM,null),(0,pe.tZ)(I.xu,null,(0,pe.tZ)(C.x,null,"Vous \xeates adh\xe9rent ",(0,_e.rY)(P.orgType)," ",P.orgName,".",(0,pe.tZ)(C.x,{fontSize:"smaller"},"Vous avez donc acc\xe8s aux \xe9v\xe9nements et discussions r\xe9serv\xe9es aux adh\xe9rents.")))),!se&&(0,pe.tZ)(hr,null,(0,pe.tZ)(E.nP,null,(0,pe.tZ)(E.x4,{"aria-hidden":!0},(0,pe.tZ)(N.r,{gridGap:5,css:Or},(0,pe.tZ)(q.P4,{light:{bg:"orange.100"},dark:{bg:"gray.500"},borderTopRadius:"lg"},(0,pe.tZ)(N.r,{templateRows:"auto 1fr"},(0,pe.tZ)(q.Q1,{borderTopRadius:"lg",alignItems:"center"},(0,pe.tZ)(L.X,{size:"sm",py:3},"Coordonn\xe9es")),(0,pe.tZ)(q.P4,{light:{bg:"orange.100"},dark:{bg:"gray.500"}},(0,pe.tZ)(I.xu,{p:5},P.orgAddress&&(0,pe.tZ)(j.k,{flexDirection:"column"},(0,pe.tZ)(j.k,{alignItems:"center"},(0,pe.tZ)(T.J,{as:b.r,mr:3}),P.orgAddress)),P.orgEmail&&(0,pe.tZ)(j.k,{flexDirection:"column"},null===(t=P.orgEmail)||void 0===t?void 0:t.map((function(e,t){var r=e.email;return(0,pe.tZ)(j.k,{key:"email-".concat(t),alignItems:"center"},(0,pe.tZ)(x.K,{mr:3}),(0,pe.tZ)(q.rU,{variant:"underline",href:"mailto:".concat(r)},r))}))),P.orgPhone&&(0,pe.tZ)(j.k,{flexDirection:"column"},null===(r=P.orgPhone)||void 0===r?void 0:r.map((function(e,t){var r=e.phone;return(0,pe.tZ)(j.k,{key:"phone-".concat(t),alignItems:"center"},(0,pe.tZ)(k.q,{mr:3}),(0,pe.tZ)(q.rU,{variant:"underline",href:"tel:+33".concat(r.substr(1,r.length))},r))}))),P.orgWeb&&(0,pe.tZ)(j.k,{flexDirection:"column"},null===(n=P.orgWeb)||void 0===n?void 0:n.map((function(e,t){var r=e.url,n=e.prefix;return(0,pe.tZ)(j.k,{key:"web-".concat(t),alignItems:"center"},(0,pe.tZ)(T.J,{as:m.j,mr:3}),(0,pe.tZ)(q.rU,{variant:"underline",href:n+r},r))}))))))),(0,pe.tZ)(q.P4,{rowSpan:1,borderTopRadius:"lg",light:{bg:"orange.100"},dark:{bg:"gray.500"}},(0,pe.tZ)(q.Q1,{borderTopRadius:"lg",alignItems:"center"},(0,pe.tZ)(j.k,{flexDirection:"row",alignItems:"center"},(0,pe.tZ)(L.X,{size:"sm",py:3},"Description ",(0,_e.rY)(P.orgType)),P.orgDescription&&X&&(0,pe.tZ)(z.u,{placement:"bottom",label:"Modifier la description"},(0,pe.tZ)(D.h,{"aria-label":"Modifier la description",icon:(0,pe.tZ)(y.d,null),bg:"transparent",ml:3,_hover:{color:"green"},onClick:function(){ue(!0),de(!0)}})))),(0,pe.tZ)(q.P4,null,(0,pe.tZ)(I.xu,{className:"ql-editor",p:5},P.orgDescription&&P.orgDescription.length>0?(0,pe.tZ)("div",{dangerouslySetInnerHTML:{__html:Q().sanitize(P.orgDescription)}}):X?(0,pe.tZ)(q.rU,{onClick:function(){de(!0),ue(!0)},variant:"underline"},"Cliquez ici pour ajouter la description"," ",(0,_e.rY)(P.orgType),"."):(0,pe.tZ)(C.x,{fontStyle:"italic"},"Aucune description.")))))),(0,pe.tZ)(E.x4,{"aria-hidden":!0},(0,pe.tZ)(yt.i,{events:g?P.orgEvents:Y,org:P,orgQuery:O,isCreator:X,isSubscribed:te,isLogin:oe,setIsLogin:ie}),(0,pe.tZ)(q.AW,null)),(0,pe.tZ)(E.x4,{"aria-hidden":!0},(0,pe.tZ)(Ft,{org:P,orgQuery:O,isCreator:X,isFollowed:!!ee,isSubscribed:te,isLogin:oe,setIsLogin:ie}),(0,pe.tZ)(q.AW,null)),(0,pe.tZ)(E.x4,{"aria-hidden":!0},(X||te)&&(0,pe.tZ)(c.bZ,{status:"info",mb:5},(0,pe.tZ)(c.zM,null),(0,pe.tZ)(I.xu,null,"Cette section a pour vocation de proposer une alternative plus simple et respectueuse des abonn\xe9es aux"," ",(0,pe.tZ)(z.u,{label:"synonymes : mailing lists, newsletters"},(0,pe.tZ)(C.x,{display:"inline",borderBottom:"1px dotted black",cursor:"pointer"},"listes de diffusion")),".")),(0,pe.tZ)(F.v,{org:P,query:O,subQuery:H,isCreator:X,isFollowed:!!ee,isSubscribed:te,isLogin:oe,setIsLogin:ie}),(0,pe.tZ)(q.AW,null)),(0,pe.tZ)(E.x4,{"aria-hidden":!0},(0,pe.tZ)(ht,{org:P,query:O,isCreator:X,isSubscribed:te,isLogin:oe,setIsLogin:ie}),(0,pe.tZ)(q.AW,null)))),se&&g&&(0,pe.tZ)(gr,{session:g,org:P,orgQuery:O,subQuery:H,isConfig:se,isEdit:ce,isVisible:ge,setIsConfig:ue,setIsEdit:de,setIsVisible:me}))},jr=r(80017),Ir=r(17497),Cr=r(58509),Pr=r(26089),Er=r(66127);function Nr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Lr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Nr(Object(r),!0).forEach((function(t){(0,J.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Nr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var zr=function(e){var t,r=(0,Le.TL)(),o=(0,Ht.Vx)(),i=(0,v.Z)(o,2),u=(i[0],i[1],(0,Ht.Gl)()),l=(0,v.Z)(u,2),d=l[0],f=(l[1],(0,p.useState)(!1)),g=f[0],m=f[1],b=(0,ue.cI)({mode:"onChange"}),Z=b.control,h=b.register,y=b.handleSubmit,x=b.errors,k=b.setError,w=b.clearErrors,O=(0,p.useState)(),S=O[0],j=O[1],C=(0,p.useState)(1),P=C[0],E=C[1],N=(0,p.useState)(),L=N[0],D=N[1],T=(0,p.useRef)(null),V=function(){var t=(0,s.Z)(a().mark((function t(o){var i,s,u,l;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("submitted",o),m(!0),i=Lr(Lr({},o),{},{userName:e.user.userName!==o.userName?(0,vt.Fv)(o.userName):void 0}),!T.current){t.next=12;break}return s=T.current.getImage(),(u=document.createElement("canvas")).width=40,u.height=40,t.next=10,(n||(n=ae()())).resize(s,u,{alpha:!0});case 10:l=t.sent,i.userImage={width:40,height:40,base64:l.toDataURL("image/png",1)};case 12:if(t.prev=12,!e.user){t.next=17;break}return t.next=16,d({payload:i,userName:e.user.userName||e.user._id}).unwrap();case 16:r((0,Pr.KY)(null));case 17:e.onSubmit&&e.onSubmit(i),t.next=23;break;case 20:t.prev=20,t.t0=t.catch(12),(0,le.S)(t.t0,(function(e,t){k(t||"formErrorMessage",{type:"manual",message:e})}));case 23:return t.prev=23,m(!1),t.finish(23);case 26:case"end":return t.stop()}}),t,null,[[12,20,23,26]])})));return function(e){return t.apply(this,arguments)}}();return(0,pe.tZ)("form",{onChange:function(){w("formErrorMessage")},onSubmit:y(V),onWheel:function(e){var t;L&&(t=L.el,(0,Cr.tG)(t))}},(0,pe.tZ)(ce.B,{errors:x,name:"formErrorMessage",render:function(e){var t=e.message;return(0,pe.tZ)(c.bZ,{status:"error",mb:3},(0,pe.tZ)(c.zM,null),(0,pe.tZ)(q.h1,null,t))}}),(0,pe.tZ)(te.NI,{id:"userName",isRequired:!0,isInvalid:!!x.userName,mb:3},(0,pe.tZ)(re.l,null,"Nom d'utilisateur"),(0,pe.tZ)(Pe.I,{name:"userName",placeholder:"Nom d'utilisateur",ref:h({required:"Veuillez saisir le nom de l'utilisateur"}),defaultValue:e.user.userName}),(0,pe.tZ)(ne.J,null,(0,pe.tZ)(ce.B,{errors:x,name:"userName"}))),(0,pe.tZ)(q.sm,{name:"email",control:Z,register:h,isRequired:!0,defaultValue:e.user.email,errors:x,mb:3,isMultiple:!1,placeholder:"Cliquez ici pour saisir votre adresse e-mail..."}),(0,pe.tZ)(c.bZ,{status:"info",mb:3},(0,pe.tZ)(c.zM,null),"Votre e-mail ne sera jamais affich\xe9 publiquement sur le site."),(0,pe.tZ)(Er.K,{name:"phone",register:h,control:Z,errors:x,isMultiple:!1,defaultValue:e.user.phone,placeholder:"Cliquez ici pour saisir votre num\xe9ro de t\xe9l\xe9phone..."}),(0,pe.tZ)(te.NI,{id:"userImage",isInvalid:!!x.userImage,mb:3},(0,pe.tZ)(re.l,null,"Avatar"),(0,pe.tZ)(z.u,{hasArrow:!0,label:e.user.userImage?"Changer l'avatar":"D\xe9finir un avatar",placement:"right"},(0,pe.tZ)(Ir.qE,{boxSize:10,name:e.user.userImage?void 0:e.user.userName,src:null===(t=e.user.userImage)||void 0===t?void 0:t.base64,mb:3,cursor:"pointer",onClick:function(){var e,t;null===(e=document)||void 0===e||null===(t=e.getElementById("fileInput"))||void 0===t||t.click()}})),(0,pe.tZ)(Pe.I,{id:"fileInput",name:"userImage",display:"none",type:"file",accept:"image/*",onChange:function(){var e=(0,s.Z)(a().mark((function e(t){var r,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=t.target.files)){e.next=10;break}if(!((n=r[0]).size<1e6)){e.next=10;break}return e.t0=j,e.next=7,se(n);case 7:e.t1=e.sent,(0,e.t0)(e.t1),w("userImage");case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ref:h({validate:function(e){return!(e&&e[0]&&e[0].size>=1e6)||"L'image ne doit pas d\xe9passer 1Mo."}})}),(0,pe.tZ)(ne.J,null,(0,pe.tZ)(ce.B,{errors:x,name:"userImage"}))),S&&(0,pe.tZ)(I.xu,{width:"200px",onWheel:function(e){e.stopPropagation(),E(function(e,t){var r=Math.max(Math.abs(t)/1e3,.1),n=t>0?e-r:e+r;return Math.min(10,Math.max(1,n))}(P,e.deltaY));var t,r=e.target;t=r,(0,Cr.Qp)(t),L||D({el:r,locked:!0})}},(0,pe.tZ)(G(),{ref:T,image:S,border:0,borderRadius:100,color:[255,255,255,.6],scale:P,rotate:0,style:{marginBottom:"12px"}})),(0,pe.tZ)(je.z,{colorScheme:"green",type:"submit",isLoading:g,isDisabled:Object.keys(x).length>0,mb:2},"Modifier"))},Dr=r(73977);function Tr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Vr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Tr(Object(r),!0).forEach((function(t){(0,J.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Tr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ar={name:"1vkc4pg",styles:"&:hover{--tw-bg-opacity:1;background-color:rgba(110, 231, 183, var(--tw-bg-opacity));;}"},Rr=function(e){var t=(0,o.Z)({},e),r=(0,d.useRouter)(),n=(0,R.k)().data||t.session,i=(0,S.useToast)({position:"top"}),u=((0,Le.TL)(),t.user._id===(null===n||void 0===n?void 0:n.user.userId)),l=u?Vr(Vr({},t.user),{},{_id:null===n||void 0===n?void 0:n.user.userId,email:null===n||void 0===n?void 0:n.user.email,userName:null===n||void 0===n?void 0:n.user.userName,userImage:null===n||void 0===n?void 0:n.user.userImage,isAdmin:null===n||void 0===n?void 0:n.user.isAdmin}):t.user,c=(0,p.useState)(),f=c[0],g=c[1],m=(0,p.useState)(!1),b=m[0],v=m[1];return(0,pe.tZ)(W.Ar,{pageTitle:l.userName,session:n},(0,pe.tZ)(p.Fragment,null,(0,pe.tZ)(j.k,{mb:5,flexDirection:"column"},(u||(null===n||void 0===n?void 0:n.user.isAdmin))&&(0,pe.tZ)(I.xu,null,(0,pe.tZ)(je.z,{"aria-label":"Modifier",leftIcon:(0,pe.tZ)(T.J,{as:b?h.R:y.d}),mr:3,onClick:function(){return v(!b)},css:Ar,"data-cy":"userEdit"},b?"Retour":"Modifier"))),b&&(0,pe.tZ)(zr,{user:l,onSubmit:function(){var e=(0,s.Z)(a().mark((function e(t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.userName,v(!1),i({title:"Votre profil a bien \xe9t\xe9 modifi\xe9 !",status:"success",isClosable:!0}),!n||n===l.userName){e.next=6;break}return e.next=6,r.push("/".concat(n));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),u&&(null===n||void 0===n?void 0:n.user.isAdmin)&&!b&&(0,pe.tZ)($.gC,{spacing:5},(0,pe.tZ)(je.z,{onClick:function(){return r.push("/sandbox")}},"Sandbox"),(0,pe.tZ)(je.z,{onClick:(0,s.Z)(a().mark((function e(){var t,r,n,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Dr.Z.get("admin/backup");case 2:t=e.sent,t.error,r=t.data,n=document.createElement("a"),o=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),n.href=o,n.download="data-"+(0,_.default)(new Date,"dd-MM-yyyy"),n.click(),window.URL.revokeObjectURL(o);case 11:case"end":return e.stop()}}),e)})))},"Exporter les donn\xe9es"),(0,pe.tZ)(jr.g,{onChange:function(e){return g(e.target.value)},placeholder:"Copiez ici les donn\xe9es export\xe9es pr\xe9c\xe9demment"}),(0,pe.tZ)(je.z,{isDisabled:!f,onClick:(0,s.Z)(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Dr.Z.post("admin/backup",f);case 2:(t=e.sent).error?i({status:"error",title:t.error.message}):i({status:"success",title:"Les donn\xe9es ont \xe9t\xe9 import\xe9es"});case 4:case"end":return e.stop()}}),e)})))},"Importer les donn\xe9es"))))},_r="",Mr=!0,Br=function(e){var t=e.email,r=(0,u.Z)(e,["email"]),n=(0,Le.TL)(),i=(0,d.useRouter)(),g=i.asPath.substr(1,i.asPath.length),m=(0,p.useState)(),b=m[0],v=m[1],Z=(0,p.useState)(),h=Z[0],y=Z[1],x=(0,p.useState)(),k=x[0],w=x[1],O=(0,p.useState)(!0),S=O[0],j=(O[1],(0,p.useState)()),I=j[0],C=j[1],P=(0,f.v9)(yr.s$);return(0,p.useEffect)((function(){t&&n((0,Ee.WG)(t))}),[]),(0,p.useEffect)((function(){var e=function(){var e=(0,s.Z)(a().mark((function e(){var t,r,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n(X.EY.initiate({eventUrl:g,populate:"orgSubscriptions"}));case 2:if(!(t=e.sent).data){e.next=7;break}v(t.data),e.next=19;break;case 7:return _r="orgBanner orgEvents orgLogo orgProjects orgSubscriptions orgTopics",e.next=10,n(Et.tn.initiate({orgUrl:g,populate:_r}));case 10:if(!(r=e.sent).data){e.next=15;break}y(r.data),e.next=19;break;case 15:return e.next=17,n(Ht.PR.initiate(g));case 17:(o=e.sent).data?w(o.data):C(new Error("La page demand\xe9e n'a pas \xe9t\xe9 trouv\xe9e. Vous allez \xeatre redirig\xe9 vers la page d'accueil dans quelques secondes."));case 19:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();v(void 0),y(void 0),w(void 0),e()}),[i.asPath,P]),b?(0,pe.tZ)(ct,(0,o.Z)({event:b},r)):h?(0,pe.tZ)(Sr,(0,o.Z)({org:h,populate:_r},r)):k?(0,pe.tZ)(Rr,(0,o.Z)({user:k},r)):(I&&setTimeout((function(){i.push("/")}),2e3),(0,pe.tZ)(W.Ar,(0,o.Z)({pageTitle:I?"Page introuvable":""},r),S?(0,pe.tZ)(l.$,null):I?(0,pe.tZ)(c.bZ,{status:"error"},(0,pe.tZ)(c.zM,null),I.message):(0,pe.tZ)(p.Fragment,null)))}},11930:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[...name]",function(){return r(77765)}])}},function(e){e.O(0,[775,507,917,929,774,888,179],(function(){return t=11930,e(e.s=t);var t}));var t=e.O();_N_E=t}]);