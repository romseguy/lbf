(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[929],{31929:function(e,t,r){"use strict";r.d(t,{v:function(){return Ze}});var n=r(809),i=r.n(n),o=r(92447),s=r(26265),a=r(64121),c=r(38347),u=r(50862),l=r(40980),p=r(45754),d=r(67294),b=r(98238),f=r(97877),g=r(48739),m=r(74860),Z=r(69822),y=r(27302),h=r(26729),v=r(36618),O=r(79887),C=r(84496),S=r(38104),k=r(80006),j=r(94096),x=r(56185),E=r(32866),w=r(42283),P=r(59830),M=r(33921),I=r(16941),_=r(70917);function L(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function N(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?L(Object(r),!0).forEach((function(t){(0,s.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var V=function(e){var t,r=e.org,n=e.event,s=(0,c.Z)(e,["org","event"]),u=(0,b.k)().data,p=(0,l.useToast)({position:"top"}),g=(0,P.EZ)(),m=(0,a.Z)(g,2),Z=m[0],L=m[1],V=(0,P.m$)(),B=(0,a.Z)(V,2),z=B[0],D=B[1],q=(0,d.useState)(!1),R=q[0],A=q[1],F=[];(r&&"aucourant"!==r.orgName||n)&&(r?(F.push(M.EE.PUBLIC),s.isCreator?(F.push(M.EE.FOLLOWERS),F.push(M.EE.SUBSCRIBERS)):s.isSubscribed&&F.push(M.EE.SUBSCRIBERS)):n&&(F.push(M.EE.PUBLIC),(s.isCreator||s.isFollowed)&&F.push(M.EE.FOLLOWERS)));var T=(0,w.cI)({mode:"onChange"}),U=T.control,W=T.register,Q=T.handleSubmit,J=T.errors,$=T.setError,H=T.clearErrors,X=function(){var e=(0,o.Z)(i().mark((function e(t){var o,a,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("submitted",t),u){e.next=3;break}return e.abrupt("return");case 3:if(A(!0),o=t.topicMessage?[{message:t.topicMessage,createdBy:u.user.userId}]:[],a={org:r,event:n,topic:{topicName:t.topicName,topicMessages:o,topicVisibility:t.topicVisibility?t.topicVisibility:M.EE[M.EE.PUBLIC],createdBy:u.user.userId}},e.prev=6,!s.topic){e.next=14;break}return e.next=10,z({payload:N(N({},a.topic),{},{topicMessages:a.topic.topicMessages.concat(s.topic.topicMessages)}),topicId:s.topic._id}).unwrap();case 10:p({title:"Votre discussion a bien \xe9t\xe9 modifi\xe9e",status:"success",isClosable:!0}),s.onSubmit&&s.onSubmit(s.topic),e.next=19;break;case 14:return e.next=16,Z({payload:a,topicNotif:t.topicNotif}).unwrap();case 16:c=e.sent,p({title:"Votre discussion a bien \xe9t\xe9 ajout\xe9e !",status:"success",isClosable:!0}),s.onSubmit&&s.onSubmit(c);case 19:s.onClose&&s.onClose(),e.next=25;break;case 22:e.prev=22,e.t0=e.catch(6),(0,I.S)(e.t0,(function(e,t){$(t||"formErrorMessage",{type:"manual",message:e})}));case 25:return e.prev=25,A(!1),e.finish(25);case 28:case"end":return e.stop()}}),e,null,[[6,22,25,28]])})));return function(t){return e.apply(this,arguments)}}();return(0,_.tZ)("form",{onChange:function(){H("formErrorMessage")},onSubmit:Q(X)},(0,_.tZ)(E.B,{errors:J,name:"formErrorMessage",render:function(e){var t=e.message;return(0,_.tZ)(y.bZ,{status:"error",mb:3},(0,_.tZ)(y.zM,null),(0,_.tZ)(f.h1,null,t))}}),(0,_.tZ)(h.NI,{id:"topicName",isRequired:!0,isInvalid:!!J.topicName,mb:3},(0,_.tZ)(v.l,null,"Objet de la discussion"),(0,_.tZ)(O.I,{name:"topicName",placeholder:"Objet de la discussion",ref:W({required:"Veuillez saisir l'objet de la discussion"}),defaultValue:s.topic?s.topic.topicName:""}),(0,_.tZ)(C.J,null,(0,_.tZ)(E.B,{errors:J,name:"topicName"}))),!s.topic&&(0,_.tZ)(h.NI,{id:"topicMessage",isInvalid:!!J.topicMessage,mb:3},(0,_.tZ)(v.l,null,"Message (optionnel)"),(0,_.tZ)(w.Qr,{name:"topicMessage",control:U,defaultValue:"",render:function(e){return(0,_.tZ)(f.Qd,{defaultValue:"",onChange:e.onChange,placeholder:"Contenu de votre message"})}}),(0,_.tZ)(C.J,null,(0,_.tZ)(E.B,{errors:J,name:"topicMessage"}))),F.length>0&&(0,_.tZ)(h.NI,{id:"topicVisibility",isRequired:!0,isInvalid:!!J.topicVisibility,mb:3},(0,_.tZ)(v.l,null,"Visibilit\xe9"),(0,_.tZ)(S.Ph,{name:"topicVisibility",defaultValue:(null===(t=s.topic)||void 0===t?void 0:t.topicVisibility)||M.EE[M.EE.PUBLIC],ref:W({required:"Veuillez s\xe9lectionner la visibilit\xe9 de la discussion"}),placeholder:"S\xe9lectionnez la visibilit\xe9 de la discussion...",color:"gray.400"},F.map((function(e){return(0,_.tZ)("option",{key:e,value:e},M.XO[e])}))),(0,_.tZ)(C.J,null,(0,_.tZ)(E.B,{errors:J,name:"topicVisibility"}))),!s.topic&&s.isCreator&&(0,_.tZ)(k.X,{ref:W(),name:"topicNotif",mb:3},"Notifier les abonn\xe9s"),(0,_.tZ)(j.k,{justifyContent:"space-between"},(0,_.tZ)(x.z,{onClick:function(){return s.onCancel&&s.onCancel()}},"Annuler"),(0,_.tZ)(x.z,{colorScheme:"green",type:"submit",isLoading:R||L.isLoading||D.isLoading,isDisabled:Object.keys(J).length>0,"data-cy":"addTopic"},s.topic?"Modifier":"Ajouter")))},B=function(e){var t=(0,m.q)({defaultIsOpen:!0}),r=t.isOpen,n=(t.onOpen,t.onClose);return(0,_.tZ)(Z.u_,{isOpen:r,onClose:function(){e.onClose&&e.onClose(),n()},closeOnOverlayClick:!1},(0,_.tZ)(Z.ZA,null,(0,_.tZ)(Z.hz,null,(0,_.tZ)(Z.xB,null,e.topic?"Modifier la discussion":"Ajouter une discussion"),(0,_.tZ)(Z.ol,null),(0,_.tZ)(Z.fe,null,(0,_.tZ)(V,e)))))},z=r(71096),D=r(19966),q=r(79011),R=r(55830),A=r(77787),F=r(46617),T=r(48017),U=r(49444),W=r(64115),Q=r(96699),J=r(48420);function $(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function H(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$(Object(r),!0).forEach((function(t){(0,s.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var X=function(e){var t=(0,b.k)().data,r=(0,d.useState)(!1),n=r[0],s=r[1],c=(0,P.EZ)(),u=(0,a.Z)(c,2),p=u[0],g=(u[1],(0,l.useToast)({position:"top"})),m=(0,d.useState)(),Z=m[0],v=m[1],O=(0,w.cI)({mode:"onChange"}),S=O.control,k=(O.register,O.handleSubmit),M=O.errors,L=O.setError,N=O.clearErrors,V=(O.watch,O.setValue,O.getValues,function(){var r=(0,o.Z)(i().mark((function r(n){var o;return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(console.log("submitted",n),t){r.next=3;break}return r.abrupt("return");case 3:return s(!0),v(void 0===Z?"":void 0),o={org:e.org,event:e.event,topic:H(H({},e.topic),{},{topicMessages:[{message:n.topicMessage,createdBy:t.user.userId}]})},r.prev=6,r.next=9,p({payload:o}).unwrap();case 9:g({title:"Votre message a bien \xe9t\xe9 ajout\xe9 !",status:"success",isClosable:!0}),e.onSubmit&&e.onSubmit(n.topicMessage),N("topicMessage"),r.next=17;break;case 14:r.prev=14,r.t0=r.catch(6),(0,I.S)(r.t0,(function(e,t){L(t||"formErrorMessage",{type:"manual",message:e})}));case 17:return r.prev=17,s(!1),r.finish(17);case 20:case"end":return r.stop()}}),r,null,[[6,14,17,20]])})));return function(e){return r.apply(this,arguments)}}());return(0,_.tZ)("form",{onChange:function(){N("formErrorMessage")},onSubmit:k(V)},(0,_.tZ)(E.B,{errors:M,name:"formErrorMessage",render:function(e){var t=e.message;return(0,_.tZ)(y.bZ,{status:"error",mb:3},(0,_.tZ)(y.zM,null),(0,_.tZ)(f.h1,null,t))}}),(0,_.tZ)(h.NI,{id:"topicMessage",isRequired:!0,isInvalid:!!M.topicMessage,p:3,pb:3},(0,_.tZ)(w.Qr,{name:"topicMessage",control:S,defaultValue:Z||"",rules:{required:"Veuillez saisir un message"},render:function(r){return(0,_.tZ)(f.Qd,{formats:e.formats,readOnly:null===t,defaultValue:Z,onChange:function(e){N("topicMessage"),r.onChange("<p><br></p>"===e?"":e)},placeholder:t?"Cliquez ici pour r\xe9pondre...":"Connectez vous pour r\xe9pondre..."})}}),(0,_.tZ)(C.J,null,(0,_.tZ)(E.B,{errors:M,name:"topicMessage"}))),(0,_.tZ)(j.k,{justifyContent:e.onCancel?"space-between":"flex-end"},e.onCancel&&(0,_.tZ)(x.z,{onClick:function(){return e.onCancel&&e.onCancel()}},"Annuler"),t?(0,_.tZ)(x.z,{colorScheme:"green",type:"submit",isLoading:n,isDisabled:Object.keys(M).length>0,mr:e.onCancel?0:3},e.topicMessage?"Modifier":"R\xe9pondre"):(0,_.tZ)(x.z,{variant:"outline",onClick:e.onLoginClick,mr:3},"Connexion")))},G=r(36636),K=r(91229),Y=r(17497),ee=r(29238),te=r.n(ee);function re(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ne(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?re(Object(r),!0).forEach((function(t){(0,s.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):re(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ie=function(e){var t=e.topic,r=e.query,n=(0,c.Z)(e,["topic","query"]),u=(0,b.k)(),p=u.data,g=(u.loading,(0,l.useColorMode)().colorMode,(0,P.m$)()),m=(0,a.Z)(g,2),Z=m[0],y=(m[1],(0,d.useState)({})),h=y[0],v=y[1],O=(0,d.useState)({}),C=O[0],S=O[1];return t?(0,_.tZ)(j.k,(0,K.Z)({flexDirection:"column"},n),(0,_.tZ)(T.xu,null,t.topicMessages.map((function(e,n){var a,c,u=e._id,l=e.message,b=e.createdBy,g=e.createdAt,m="",y=b;"object"===typeof b&&(m=b.userName,a=null===(c=b.userImage)||void 0===c?void 0:c.base64,y=b._id);var O=G.Sy(g),k=O.timeAgo,E=O.fullDate,w=y===(null===p||void 0===p?void 0:p.user.userId)||(null===p||void 0===p?void 0:p.user.isAdmin);return(0,_.tZ)(T.xu,{key:u,display:"flex",pb:3},(0,_.tZ)(f.rU,{variant:"no-underline",href:m},(0,_.tZ)(Y.qE,{name:m,boxSize:10,src:a})),(0,_.tZ)(T.xu,{ml:2},(0,_.tZ)(f.W2,{borderRadius:18,light:{bg:"white"},dark:{bg:"gray.600"},px:3,"data-cy":"topicMessage"},(0,_.tZ)(f.rU,{href:"/".concat(m),fontWeight:"bold"},m),u&&h[u]&&h[u].isOpen?(0,_.tZ)(T.xu,{pt:1,pb:3},(0,_.tZ)(f.Qd,{formats:f.bd.filter((function(e){return"size"!==e})),defaultValue:l,onChange:function(e){v(ne(ne({},h),{},(0,s.Z)({},u,ne(ne({},h[u]),{},{html:e}))))},placeholder:"Contenu de votre message"}),(0,_.tZ)(j.k,{alignItems:"center",justifyContent:"space-between",mt:3},(0,_.tZ)(x.z,{onClick:function(){return v(ne(ne({},h),{},(0,s.Z)({},u,ne(ne({},h[u]),{},{isOpen:!1}))))}},"Annuler"),(0,_.tZ)(x.z,{colorScheme:"green",onClick:(0,o.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z({payload:ne(ne({},t),{},{topicMessages:t.topicMessages.map((function(e){return e._id===u?ne(ne({},e),{},{message:h[u].html||""}):e}))}),topicId:t._id}).unwrap();case 2:r.refetch(),v(ne(ne({},h),{},(0,s.Z)({},u,ne(ne({},h[u]),{},{isOpen:!1}))));case 4:case"end":return e.stop()}}),e)})))},"Modifier"))):(0,_.tZ)(T.xu,{className:"ql-editor"},(0,_.tZ)("div",{dangerouslySetInnerHTML:{__html:te().sanitize(l)}}))),(0,_.tZ)(f.rU,{pl:3,fontSize:"smaller","aria-hidden":!0},(0,_.tZ)(Q.u,{placement:"bottom",label:E},(0,_.tZ)("span",null,k))),w&&(0,_.tZ)(d.Fragment,null,(0,_.tZ)("span",{"aria-hidden":!0}," \xb7 "),(0,_.tZ)(Q.u,{placement:"bottom",label:"Modifier le message"},(0,_.tZ)(J.h,{"aria-label":"Modifier le message",icon:(0,_.tZ)(F.d,null),bg:"transparent",height:"auto",minWidth:0,_hover:{color:"green"},onClick:function(e){e.stopPropagation(),u&&v(ne(ne({},h),{},(0,s.Z)({},u,ne(ne({},h[u]),{},{isOpen:!0}))))}})),(0,_.tZ)("span",{"aria-hidden":!0}," \xb7 "),(0,_.tZ)(f.m1,{isIconOnly:!0,isLoading:u&&C[u]&&!r.isLoading&&!r.isFetching,bg:"transparent",height:"auto",minWidth:0,_hover:{color:"red"},placement:"bottom",header:(0,_.tZ)(d.Fragment,null,"\xcates vous s\xfbr de vouloir supprimer ce message ?"),onClick:(0,o.Z)(i().mark((function e(){var o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u&&S((0,s.Z)({},u,!0)),o=ne(ne({},t),{},{topicMessages:n===t.topicMessages.length-1?t.topicMessages.filter((function(e){return e._id!==u})):t.topicMessages.map((function(e){return e._id===u?{_id:u,message:"<i>Message supprim\xe9</i>",createdBy:b,createdAt:g}:e}))}),e.prev=2,e.next=5,Z({payload:o,topicId:t._id}).unwrap();case 5:r.refetch(),u&&S((0,s.Z)({},u,!1)),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),console.error(e.t0);case 12:case"end":return e.stop()}}),e,null,[[2,9]])})))}))))})))):null},oe=r(76714),se=r(32379),ae=r(17377),ce=r(70058),ue=function(e){var t=e.topicVisibility;return t===M.EE.SUBSCRIBERS?(0,_.tZ)(Q.u,{label:"Discussion r\xe9serv\xe9e aux adh\xe9rents"},(0,_.tZ)("span",null,(0,_.tZ)(ce.J,{as:se.h,boxSize:4}))):t===M.EE.FOLLOWERS?(0,_.tZ)(Q.u,{label:"Discussion r\xe9serv\xe9e aux abonn\xe9s"},(0,_.tZ)(ae.L,{boxSize:4})):t===M.EE.PUBLIC?(0,_.tZ)(Q.u,{label:"Discussion publique"},(0,_.tZ)("span",null,(0,_.tZ)(ce.J,{as:oe.j,boxSize:4}))):null},le=r(35528),pe=function(e){var t=e.topic,r=e.isSubbedToTopic,n=(0,b.k)(),i=n.data,o=(n.loading,(0,z.Tb)({topicId:t._id}));return(0,d.useEffect)((function(){return o.refetch}),[r]),o.isLoading||o.isFetching?(0,_.tZ)(p.$,{boxSize:4}):Array.isArray(o.data)&&o.data.length>0?(0,_.tZ)(W.x,null,"Abonn\xe9s \xe0 la discussion :"," ",o.data.map((function(e){if("object"===typeof e.user){var t=e.user.userName||(null===i||void 0===i?void 0:i.user.email.replace(/@.+/,""));return(0,_.tZ)(f.rU,{key:e._id,href:"/".concat(t)},(0,_.tZ)(le.Vp,{mr:1,mb:1},t))}}))):(0,_.tZ)(W.x,null,"Aucun abonn\xe9s \xe0 la discussion.")};function de(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function be(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?de(Object(r),!0).forEach((function(t){(0,s.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):de(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var fe=function(e){var t,r=e.event,n=e.org,s=e.query,a=e.isSubscribed,c=e.topic,u=e.topicIndex,l=e.isSubbedToTopic,b=e.isCurrent,g=e.isCreator,m=e.isDark,Z=e.isLoading,y=e.notifyModalState,h=e.setNotifyModalState,v=e.onClick,O=e.onEditClick,C=e.onDeleteClick,S=e.onSubscribeClick,k=e.onLoginClick,j=G.Sy(c.createdAt,!0),x=j.timeAgo,E=j.fullDate,w="object"===typeof c.createdBy?c.createdBy.userName||(null===(t=c.createdBy.email)||void 0===t?void 0:t.replace(/@.+/,"")):"";return(0,_.tZ)(T.xu,{key:c._id,mb:5},(0,_.tZ)(f.P4,null,(0,_.tZ)(U.r,{variant:"no-underline",onClick:v,"data-cy":"topic"},(0,_.tZ)(f.rj,{templateColumns:"auto 1fr auto",borderTopRadius:"xl",borderBottomRadius:b?void 0:"lg",light:{bg:u%2===0?"orange.200":"orange.100",_hover:{bg:"orange.300"}},dark:{bg:u%2===0?"gray.600":"gray.500",_hover:{bg:"gray.400"}}},(0,_.tZ)(f.P4,{display:"flex",alignItems:"center",p:3},b?(0,_.tZ)(R.O,{boxSize:6}):(0,_.tZ)(A.t,{boxSize:6})),(0,_.tZ)(f.P4,{py:3},(0,_.tZ)(T.xu,{lineHeight:"1","data-cy":"topicHeader"},(0,_.tZ)(W.x,{fontWeight:"bold"},c.topicName),(0,_.tZ)(T.xu,{display:"inline",fontSize:"smaller",color:m?"white":"gray.600"},w,(0,_.tZ)("span",{"aria-hidden":!0}," \xb7 "),(0,_.tZ)(Q.u,{placement:"bottom",label:E},(0,_.tZ)("span",null,x)),(0,_.tZ)("span",{"aria-hidden":!0}," \xb7 "),(0,_.tZ)(ue,{topicVisibility:c.topicVisibility}),Array.isArray(c.topicNotified)&&g&&(g||a)&&(0,_.tZ)(d.Fragment,null,(0,_.tZ)("span",{"aria-hidden":!0}," \xb7 "),(0,_.tZ)(U.r,{onClick:function(e){e.stopPropagation(),h(be(be({},y),{},{entity:c}))}},c.topicNotified.length," abonn\xe9s notifi\xe9s"))))),(0,_.tZ)(f.P4,{display:"flex",alignItems:"center"},Z?(0,_.tZ)(p.$,{mr:3,boxSize:4}):(0,_.tZ)(d.Fragment,null,g&&(0,_.tZ)(d.Fragment,null,(0,_.tZ)(Q.u,{placement:"bottom",label:"Modifier la discussion"},(0,_.tZ)(J.h,{"aria-label":"Modifier la discussion",icon:(0,_.tZ)(F.d,null),bg:"transparent",height:"auto",minWidth:0,_hover:{color:"green"},onClick:function(e){e.stopPropagation(),O()}})),(0,_.tZ)(T.xu,{"aria-hidden":!0,mx:1},"\xb7"," "),(0,_.tZ)(f.m1,{isIconOnly:!0,placement:"bottom",bg:"transparent",height:"auto",minWidth:0,_hover:{color:"red"},header:(0,_.tZ)(d.Fragment,null,"\xcates vous s\xfbr de vouloir supprimer la discussion",(0,_.tZ)(W.x,{display:"inline",color:"red",fontWeight:"bold"}," ".concat(c.topicName))," ","?"),onClick:C,"data-cy":"deleteTopic"}),(0,_.tZ)(T.xu,{"aria-hidden":!0,mx:1},"\xb7")),(0,_.tZ)(Q.u,{label:l?"Vous recevez une notification lorsque quelqu'un r\xe9pond \xe0 cette discussion.":"Recevoir un e-mail et une notification lorsque quelqu'un r\xe9pond \xe0 cette discussion.",placement:"left"},(0,_.tZ)("span",null,(0,_.tZ)(J.h,{"aria-label":l?"Se d\xe9sabonner de la discussion":"S'abonner \xe0 la discussion",icon:l?(0,_.tZ)(q.C,null):(0,_.tZ)(D.Z,null),bg:"transparent",height:"auto",minWidth:0,mr:3,_hover:{color:m?"lightgreen":"white"},onClick:function(){var e=(0,o.Z)(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.stopPropagation(),S();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),"data-cy":l?"topicUnsubscribe":"topicSubscribe"}))))))),b&&(0,_.tZ)(d.Fragment,null,(0,_.tZ)(f.P4,{light:{bg:"orange.50"},dark:{bg:"gray.700"}},(0,_.tZ)(ie,{query:s,topic:c,pt:3,px:3})),(0,_.tZ)(f.P4,{bg:m?"gray.600":"gray.200",borderRadius:"lg",p:3},(0,_.tZ)(pe,{topic:c,isSubbedToTopic:l})),(0,_.tZ)(f.P4,{light:{bg:"orange.50"},dark:{bg:"gray.700"},pb:3,borderBottomRadius:"xl"},(0,_.tZ)(X,{event:r,org:n,topic:c,formats:f.bd.filter((function(e){return"size"!==e})),onLoginClick:k,onSubmit:function(){return s.refetch()}})))))};function ge(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function me(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ge(Object(r),!0).forEach((function(t){(0,s.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ge(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ze=function(e){var t=e.event,r=e.org,n=e.query,m=e.subQuery,Z=e.isLogin,y=e.setIsLogin,h=(0,c.Z)(e,["event","org","query","subQuery","isLogin","setIsLogin"]),v="dark"===(0,l.useColorMode)().colorMode,O=(0,b.k)(),C=O.data,S=O.loading,k=(0,l.useToast)({position:"top"}),j=(0,z.l_)(),x=(0,a.Z)(j,2),E=x[0],w=(x[1],(0,z.h_)()),I=(0,a.Z)(w,2),L=I[0],N=(I[1],(0,P.Vz)()),V=(0,P.Wn)(),D=(0,a.Z)(V,2),q=D[0],R=(D[1],(0,d.useState)({})),A=R[0],F=R[1],T=(0,d.useState)({isOpen:!1,entity:null}),U=T[0],W=T[1],Q=(0,d.useState)({entity:null}),J=Q[0],$=Q[1],H=(0,d.useState)(null),X=H[0],G=H[1],K=r?r.orgName:null===t||void 0===t?void 0:t.eventName,Y=r?r.orgTopics:t?t.eventTopics:[];return(0,_.tZ)(d.Fragment,null,(0,_.tZ)(f.zx,{colorScheme:"teal",leftIcon:(0,_.tZ)(u.d,null),mb:5,onClick:function(){S||(C?W(me(me({},U),{},{isOpen:!0})):y(Z+1))},"data-cy":"addTopicForm"},"Ajouter une discussion"),U.isOpen&&(0,_.tZ)(B,{topic:U.entity,org:r,event:t,isCreator:h.isCreator,isFollowed:h.isFollowed,isSubscribed:h.isSubscribed,onCancel:function(){return W(me(me({},U),{},{isOpen:!1,entity:null}))},onSubmit:function(){var e=(0,o.Z)(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.refetch(),m.refetch(),W(me(me({},U),{},{isOpen:!1,entity:null})),G(t||null);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onClose:function(){return W(me(me({},U),{},{isOpen:!1,entity:null}))}}),(0,_.tZ)(g.i,{event:t,org:r,query:n,mutation:N,setModalState:$,modalState:J}),(0,_.tZ)(f.rj,{"data-cy":"topicList"},n.isLoading?(0,_.tZ)(p.$,null):Y.filter((function(e){if("aucourant"===K)return!0;var t=!1;return e.topicVisibility===M.EE.PUBLIC?t=!0:(h.isCreator&&(t=!0),h.isSubscribed&&e.topicVisibility===M.EE.SUBSCRIBERS&&(t=!0),h.isFollowed&&e.topicVisibility===M.EE.FOLLOWERS&&(t=!0)),t})).map((function(e,a){var c=e._id===(null===X||void 0===X?void 0:X._id),u="object"===typeof e.createdBy?e.createdBy._id:e.createdBy,l=(null===C||void 0===C?void 0:C.user.isAdmin)||u===(null===C||void 0===C?void 0:C.user.userId),p=!1;return m.data&&(p=!!m.data.topics.find((function(t){return t.topic._id===e._id}))),(0,_.tZ)(fe,{key:e._id,event:t,org:r,query:n,isSubscribed:h.isSubscribed||!1,topic:e,topicIndex:a,isSubbedToTopic:p,isCurrent:c,isCreator:l,isDark:v,isLoading:A[e._id]||n.isLoading,notifyModalState:J,setNotifyModalState:$,onClick:function(){return G(c?null:e)},onEditClick:function(){return W(me(me({},U),{},{isOpen:!0,entity:e}))},onDeleteClick:(0,o.Z)(i().mark((function t(){var r;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(F((0,s.Z)({},e._id,!0)),t.prev=1,r=null,!e._id){t.next=7;break}return t.next=6,q(e._id).unwrap();case 6:r=t.sent;case 7:r&&(m.refetch(),n.refetch(),k({title:"".concat(r.topicName," a bien \xe9t\xe9 supprim\xe9 !"),status:"success",isClosable:!0})),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(1),k({title:t.t0.data?t.t0.data.message:t.t0.message,status:"error",isClosable:!0});case 13:return t.prev=13,F((0,s.Z)({},e._id,!1)),t.finish(13);case 16:case"end":return t.stop()}}),t,null,[[1,10,13,16]])}))),onSubscribeClick:(0,o.Z)(i().mark((function t(){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(F((0,s.Z)({},e._id,!0)),m.data&&p){t.next=7;break}return t.next=4,L({payload:{topics:[{topic:e,emailNotif:!0,pushNotif:!0}]},user:null===C||void 0===C?void 0:C.user.userId});case 4:k({title:"Vous \xeates abonn\xe9 \xe0 la discussion ".concat(e.topicName),status:"success",isClosable:!0}),t.next=13;break;case 7:if(!p){t.next=13;break}if(!confirm("\xcates vous s\xfbr de vouloir vous d\xe9sabonner de la discussion : ".concat(e.topicName," ?"))){t.next=13;break}return t.next=12,E({subscriptionId:m.data._id,topicId:e._id});case 12:k({title:"Vous \xeates d\xe9sabonn\xe9 de ".concat(e.topicName),status:"success",isClosable:!0});case 13:m.refetch(),F((0,s.Z)({},e._id,!1));case 15:case"end":return t.stop()}}),t)}))),onLoginClick:function(){return y(Z+1)}})}))))}}}]);