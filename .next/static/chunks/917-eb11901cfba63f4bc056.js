(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[917],{64263:function(e,t,n){"use strict";n.d(t,{G:function(){return S}});var r=n(26265),o=n(57974),a=n(68718),i=n(23762),l=n(64115),u=n(48017),s=n(23855),c=n(85817),f=n(20466),d=n(16032),v=n(38779),p=n(49151),g=n(67294),m=n(36636),Z=n(70917);function h(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var O={name:"15g69pj",styles:'&>li{list-style:none;margin-left:12px;margin-top:0!important;border-left:2px dashed #3f4e58;padding:0 0 0 20px;position:relative;&::before{position:absolute;left:-14px;top:0;content:" ";border:8px solid rgba(255, 255, 255, 0.74);border-radius:500%;background:#3f4e58;height:25px;width:25px;transition:all 500ms ease-in-out;}}'},S=function(e){var t=e.event,n=(0,s.default)(t.eventMinDate),b=(0,s.default)(t.eventMaxDate),y=(0,c.default)(n),S=((0,c.default)(b),(0,f.default)(n));S=0===S?6:S-1;var x=m.an.reduce((function(e,o,a){if(S===a)return w(w({},e),{},(0,r.Z)({},a,{startDate:n,endTime:b}));if(t.otherDays){var i,l=h(t.otherDays);try{for(l.s();!(i=l.n()).done;){var u=i.value,c=u.dayNumber,f=u.startDate,v=u.endTime;if(c===a)return w(w({},e),{},(0,r.Z)({},a,{startDate:f?(0,s.default)(f):(0,d.Z)(n,c+1),endTime:v?(0,s.default)(v):(0,d.Z)(b,c+1)}))}}catch(p){l.e(p)}finally{l.f()}}return e}),{});return(0,Z.tZ)(g.Fragment,null,t.repeat&&(0,Z.tZ)(l.x,{fontWeight:"bold"},(0,Z.tZ)(a.Q,{mr:1}),99===t.repeat?"Toutes les semaines":""),(0,Z.tZ)(i.aV,{spacing:3,css:O},Object.keys(x).map((function(e){var t=parseInt(e),n=x[t];return(0,Z.tZ)(i.HC,{key:"timeline-item-"+e},(0,Z.tZ)(l.x,{fontWeight:"bold"},(0,v.default)(n.startDate,"cccc d MMMM",{locale:p.Z})),(0,Z.tZ)(u.xu,{display:"flex",alignItems:"center",ml:3,fontWeight:"bold"},(0,Z.tZ)(l.x,{color:"green"},(0,v.default)(n.startDate,"H:mm",{locale:p.Z})),(0,Z.tZ)(o.m,null),(0,Z.tZ)(l.x,{color:"red"},(0,f.default)(n.startDate)!==(0,f.default)(n.endTime)?(0,v.default)(n.endTime,"cccc d MMMM",{locale:p.Z}):""," ",(0,v.default)(n.endTime,"H:mm",{locale:p.Z}))))}))))}},21526:function(e,t,n){"use strict";n.d(t,{i:function(){return Re}});var r=n(809),o=n.n(r),a=n(92447),i=n(91229),l=n(26265),u=n(64121),s=n(38347),c=n(50862),f=n(40980),d=n(48017),v=n(9345),p=n(336),g=n(27302),m=n(56185),Z=n(64115),h=n(37042),b=n(23855),y=n(67814),w=n(17445),O=n(63500),S=n(16032),x=n(78343),D=n(49474),C=n(71047),M=n(38779),E=n(49151),k=n(29238),j=n.n(k),P=n(11163),N=n(67294),I=n(97877),A=n(35011),T=n(48739),L=n(95978),F=n(74860),_=n(69822),z=n(32866),R=n(45754),U=n(26729),V=n(36618),W=n(84496),B=n(94096),H=n(42283),Q=n(39424),q=n(98238),J=n(79416),Y=n(12207),G=n(16941),X=n(70917);function $(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ee=function(e){var t=(0,i.Z)({},e),n=(0,P.useRouter)(),r=(0,q.k)().data,l=(0,f.useToast)({position:"top"}),s=(0,J.SY)(),c=(0,u.Z)(s,2),d=c[0],v=(c[1],(0,N.useState)(!1)),p=v[0],Z=v[1],h=(0,H.cI)(),b=h.control,y=h.errors,w=h.handleSubmit,O=h.setError,S=h.clearErrors,x=(0,Y.Gt)({populate:"orgSubscriptions orgEvents",createdBy:null===r||void 0===r?void 0:r.user.userId}),D=x.data,C=x.isLoading,M=x.refetch,E=null===D||void 0===D?void 0:D.filter((function(e){return!e.orgEvents.find((function(e){var n;return t.event._id===e._id||(null===(n=e.forwardedFrom)||void 0===n?void 0:n.eventId)===t.event._id}))}));(0,N.useEffect)((function(){M()}),[n.asPath]);var k=function(){var e=(0,a.Z)(o().mark((function e(n){var a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.orgs,e.prev=1,Z(!0),e.next=5,d(K(K({},t.event),{},{_id:void 0,eventName:t.event._id,forwardedFrom:{eventId:t.event._id},eventOrgs:a,createdBy:null===r||void 0===r?void 0:r.user.userId}));case 5:l({title:"L'\xe9v\xe9nement a bien \xe9t\xe9 rediffus\xe9 !",status:"success",isClosable:!0}),M(),t.onSubmit&&t.onSubmit(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),(0,G.S)(e.t0,(function(e,t){O(t||"formErrorMessage",{type:"manual",message:e})}));case 13:return e.prev=13,Z(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,10,13,16]])})));return function(t){return e.apply(this,arguments)}}();return(0,X.tZ)("form",{onChange:function(){S("formErrorMessage")},onSubmit:w(k)},(0,X.tZ)(z.B,{errors:y,name:"formErrorMessage",render:function(e){var t=e.message;return(0,X.tZ)(g.bZ,{status:"error",mb:3},(0,X.tZ)(g.zM,null),(0,X.tZ)(I.h1,null,t))}}),C?(0,X.tZ)(R.$,null):(0,X.tZ)(U.NI,{mb:3,id:"orgs",isInvalid:!!y.orgs,isRequired:!0},(0,X.tZ)(V.l,null,"Organisations"),(0,X.tZ)(H.Qr,{name:"orgs",rules:{required:"Veuillez s\xe9lectionner une ou plusieurs organisations"},as:Q.ZP,control:b,defaultValue:null,placeholder:"S\xe9lectionner une ou plusieurs organisations",menuPlacement:"top",isClearable:!0,isMulti:!0,isSearchable:!0,closeMenuOnSelect:!0,styles:{placeholder:function(){return{color:"#A0AEC0"}},control:function(e){return K(K({},e),{},{borderColor:"#e2e8f0",paddingLeft:"8px"})}},className:"react-select-container",classNamePrefix:"react-select",options:E,getOptionLabel:function(e){return"".concat(e.orgName)},getOptionValue:function(e){return e._id},onChange:function(e){return(0,u.Z)(e,1)[0]._id}}),(0,X.tZ)(W.J,null,(0,X.tZ)(z.B,{errors:y,name:"orgs"}))),(0,X.tZ)(B.k,{justifyContent:"space-between"},(0,X.tZ)(m.z,{onClick:function(){return t.onCancel&&t.onCancel()}},"Annuler"),(0,X.tZ)(m.z,{colorScheme:"green",type:"submit",isLoading:p,isDisabled:Object.keys(y).length>0},"Rediffuser")))},te=function(e){var t=(0,F.q)({defaultIsOpen:!0}),n=t.isOpen,r=(t.onOpen,t.onClose);return(0,X.tZ)(_.u_,{isOpen:n,onClose:function(){e.onClose&&e.onClose(),r()},closeOnOverlayClick:!1},(0,X.tZ)(_.ZA,null,(0,X.tZ)(_.hz,null,(0,X.tZ)(_.xB,null,"Rediffuser l'\xe9v\xe9nement : ",e.event.eventName),(0,X.tZ)(_.ol,null),(0,X.tZ)(_.fe,null,(0,X.tZ)(ee,e)))))},ne=n(81442),re=n(17823),oe=n(49759),ae=n(18716),ie=n(34281),le=n(88853),ue=n(1424),se=n(87296),ce=n(6402),fe=n(27626),de=n(71858),ve=n(17377),pe=n(2827),ge=n(70058),me=n(96699),Ze=n(48420),he=n(35528),be=n(39159),ye=n(20466),we=n(83863),Oe=n(76714),Se=n(32379),xe=function(e){var t=e.eventVisibility;return t===re.Hk.SUBSCRIBERS?(0,X.tZ)(me.u,{label:"\xc9v\xe9nement r\xe9serv\xe9 aux adh\xe9rents"},(0,X.tZ)("span",null,(0,X.tZ)(ge.J,{as:Se.h,boxSize:4}))):t===re.Hk.PUBLIC?(0,X.tZ)(me.u,{label:"\xc9v\xe9nement public"},(0,X.tZ)("span",null,(0,X.tZ)(ge.J,{as:Oe.j,boxSize:4}))):null},De=n(1609);function Ce(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Me(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ce(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ce(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ee={name:"k4khca",styles:"letter-spacing:0.1em"},ke=function(e){var t=e.deleteEvent,n=e.editEvent,r=e.editOrg,i=e.event,l=e.index,u=e.isCreator,c=e.isDark,f=e.isLoading,p=(e.setIsLoading,e.org),g=e.orgQuery,m=e.orgFollowersCount,h=e.length,b=e.session,y=(e.eventToForward,e.setEventToForward),w=e.notifyModalState,O=e.setNotifyModalState,S=(e.eventToShow,e.setEventToShow),x=e.toast,D=((0,s.Z)(e,["deleteEvent","editEvent","editOrg","event","index","isCreator","isDark","isLoading","setIsLoading","org","orgQuery","orgFollowersCount","length","session","eventToForward","setEventToForward","notifyModalState","setNotifyModalState","eventToShow","setEventToShow","toast"]),i.eventMinDate),C=i.eventMaxDate,k=p&&u,j=[k,!!i.eventCategory,!!p].filter((function(e){return e})).flatMap((function(e){return"auto "})),P=0;return m&&((null===b||void 0===b?void 0:b.user.userId)===i.createdBy||null!==b&&void 0!==b&&b.user.isAdmin)&&(P=m-(Array.isArray(i.eventNotified)?i.eventNotified.length:0)),(0,X.tZ)(N.Fragment,null,(0,X.tZ)(I.P4,{rowSpan:3,light:{bg:"orange.100"},dark:{bg:"gray.500"},borderBottomLeftRadius:l===h-1?"lg":void 0},(0,X.tZ)(d.xu,{pt:2,pl:2,pr:2},(0,X.tZ)(Z.x,{pb:1,title:void 0},(0,M.default)(D,"H'h'".concat(0!==(0,be.default)(D)?"mm":""),{locale:E.Z})),(0,X.tZ)(ge.J,{as:ce.$}),(0,X.tZ)(Z.x,{pt:2},(0,ye.default)(D)!==(0,ye.default)(C)&&(0,M.default)(C,"EEEE",{locale:E.Z})," ",(0,M.default)(C,"H'h'".concat(0!==(0,be.default)(C)?"mm":""),{locale:E.Z})))),(0,X.tZ)(I.P4,{light:{bg:"white"},dark:{bg:"gray.700"},alignItems:"center"},(0,X.tZ)(v.r,{alignItems:"center",css:(0,X.iv)("grid-template-columns:auto auto ",j[0]," 1fr;@media (max-width: 700px){grid-template-columns:1fr!important;&:first-of-type{padding-top:4px;}}","")},k&&(0,X.tZ)(I.P4,{pl:1},i.isApproved?(0,X.tZ)(me.u,{label:"\xc9v\xe9nement approuv\xe9"},(0,X.tZ)(fe.r,{color:"green"})):(0,X.tZ)(me.u,{label:"\xc9v\xe9nement en attente de mod\xe9ration"},(0,X.tZ)(de.a,{color:"orange"})),p&&u&&(0,X.tZ)(me.u,{label:0===P?"Tous les abonn\xe9s ont re\xe7u l'invitation":"".concat(P," abonn\xe9").concat(P>1?"s":""," ").concat((0,oe.rY)(p.orgType)," ").concat(p.orgName," n'").concat(P>1?"ont":"a"," pas encore re\xe7u d'invitation.")},(0,X.tZ)(Ze.h,{"aria-label":0===P?"Aucun abonn\xe9 \xe0 inviter":"Inviter les abonn\xe9s de ".concat(p.orgName),icon:(0,X.tZ)(ve.L,null),isLoading:f,isDisabled:!i.isApproved,title:i.isApproved?"":"L'\xe9v\xe9nement est en attente de mod\xe9ration",bg:"transparent",height:"auto",minWidth:0,mx:2,_hover:{background:"transparent",color:"green"},onClick:function(e){O(Me(Me({},w),{},{entity:i}))}}))),"number"===typeof i.eventCategory&&(0,X.tZ)(I.P4,{pl:1},(0,X.tZ)(he.Vp,{color:"white",bgColor:"transparent"===re.WD[i.eventCategory].bgColor?c?"whiteAlpha.100":"blackAlpha.600":re.WD[i.eventCategory].bgColor,mr:1},re.WD[i.eventCategory].label)),(0,X.tZ)(I.P4,{pl:1},(0,X.tZ)(I.rU,{className:"rainbow-text",css:Ee,mr:1,size:"larger",href:"/".concat(encodeURIComponent(i.eventUrl)),shallow:!0},i.eventName)),(0,X.tZ)(I.P4,{whiteSpace:"nowrap",pl:1},p&&(0,X.tZ)(xe,{eventVisibility:i.eventVisibility}),b&&!i.forwardedFrom?(0,X.tZ)(me.u,{label:"Rediffuser"},(0,X.tZ)("span",null,(0,X.tZ)(Ze.h,{"aria-label":"Rediffuser",icon:(0,X.tZ)(se.F,null),bg:"transparent",_hover:{background:"transparent",color:"green"},minWidth:0,ml:2,height:"auto",onClick:function(){y(Me(Me({},i),{},{eventMinDate:(0,we.Z)(D),eventMaxDate:(0,we.Z)(C)}))}}))):p&&i.forwardedFrom&&i.forwardedFrom.eventId&&(null===b||void 0===b?void 0:b.user.userId)===i.createdBy?(0,X.tZ)(me.u,{label:"Annuler la rediffusion"},(0,X.tZ)(Ze.h,{"aria-label":"Annuler la rediffusion",icon:(0,X.tZ)(pe.p,null),bg:"transparent",height:"auto",minWidth:0,ml:2,_hover:{background:"transparent",color:"red"},onClick:(0,a.Z)(o().mark((function e(){var a,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!confirm("\xcates vous s\xfbr de vouloir annuler la rediffusion ?")){e.next=13;break}if(!(i.eventOrgs.length<=1)){e.next=7;break}return e.next=5,t({eventUrl:null===(a=i.forwardedFrom)||void 0===a?void 0:a.eventId}).unwrap();case 5:e.next=11;break;case 7:return e.next=9,n({eventUrl:null===(l=i.forwardedFrom)||void 0===l?void 0:l.eventId,payload:{eventOrgs:i.eventOrgs.filter((function(e){return"object"===typeof e?e._id!==p._id:e!==p._id}))}});case 9:return e.next=11,r({orgUrl:p.orgUrl,payload:{orgEvents:p.orgEvents.filter((function(e){return e._id!==i._id}))}});case 11:g.refetch(),x({title:"La rediffusion a bien \xe9t\xe9 annul\xe9e.",status:"success",isClosable:!0});case 13:case"end":return e.stop()}}),e)})))})):i.forwardedFrom&&i.forwardedFrom.eventId&&p&&(0,X.tZ)(me.u,{label:"Rediffus\xe9 par ".concat(p.orgName)},(0,X.tZ)("span",null,(0,X.tZ)(ge.J,{as:se.F,color:"green",ml:2})))))),(0,X.tZ)(I.P4,{rowSpan:3,light:{bg:"orange.100"},dark:{bg:"gray.500"},borderBottomRightRadius:l===h-1?"lg":void 0},(0,X.tZ)(d.xu,{pt:2,pl:2,pr:2},(0,X.tZ)(Z.x,null,i.eventCity||"\xc0 d\xe9finir"))),(0,X.tZ)(I.P4,{pl:3,pb:3,light:{bg:"white"},dark:{bg:"gray.700"}},i.eventDescription&&i.eventDescription.length>0?(0,X.tZ)(I.rU,{variant:"underline",onClick:function(){return S(Me(Me({},i),{},{eventMinDate:(0,we.Z)(D),eventMaxDate:(0,we.Z)(C)}))}},"Voir l'affiche de l'\xe9v\xe9nement"):(0,X.tZ)(Z.x,{fontSize:"smaller"},"Aucune affiche disponible.")),!p&&(0,X.tZ)(I.P4,{light:{bg:"white"},dark:{bg:"gray.700"},pl:3,pb:3},(0,De.t)(i.eventOrgs)?i.eventOrgs.map((function(e){return(0,X.tZ)(I.rU,{key:e.orgUrl,href:"/".concat(e.orgUrl),shallow:!0},(0,X.tZ)(he.Vp,null,(0,X.tZ)(ge.J,{as:ue.S,mr:1}),e.orgName))})):"object"===typeof i.createdBy&&(0,X.tZ)(I.rU,{href:"/".concat(i.createdBy.userName),shallow:!0},(0,X.tZ)(he.Vp,null,(0,X.tZ)(ge.J,{as:le.j,mr:1}),i.createdBy.userName))))},je=n(76896),Pe=n(57974),Ne=function(e){var t=e.previousEvents,n=e.showPreviousEvents,r=e.setShowPreviousEvents,o=e.currentEvents,a=e.nextEvents,l=e.showNextEvents,u=e.setShowNextEvents,c=(0,s.Z)(e,["previousEvents","showPreviousEvents","setShowPreviousEvents","currentEvents","nextEvents","showNextEvents","setShowNextEvents"]);return t.length||o.length||a.length?(0,X.tZ)(B.k,(0,i.Z)({flexDirection:"row",flexWrap:"wrap",mt:-3},c),(0,X.tZ)(d.xu,{flexGrow:1,mt:3},!l&&(0,X.tZ)(N.Fragment,null,!n&&t.length>0&&(0,X.tZ)(m.z,{colorScheme:"teal",fontSize:"smaller",height:7,leftIcon:(0,X.tZ)(je.R,null),onClick:function(){r(!0)}},"Voir les \xe9v\xe9n\xe9ments pr\xe9c\xe9dents"),n&&(0,X.tZ)(m.z,{colorScheme:"pink",fontSize:"smaller",height:7,rightIcon:(0,X.tZ)(Pe.m,null),onClick:function(){r(!1)}},"Revenir aux \xe9v\xe9nements de cette semaine"))),(0,X.tZ)(d.xu,{mt:3},!n&&(0,X.tZ)(N.Fragment,null,!l&&a.length>0&&(0,X.tZ)(m.z,{colorScheme:"teal",fontSize:"smaller",height:7,leftIcon:l?(0,X.tZ)(je.R,null):void 0,rightIcon:l?void 0:(0,X.tZ)(Pe.m,null),onClick:function(){u(!l)}},"Voir les \xe9v\xe9n\xe9ments suivants"),l&&(0,X.tZ)(m.z,{colorScheme:"pink",fontSize:"smaller",height:7,leftIcon:l?(0,X.tZ)(je.R,null):void 0,rightIcon:l?void 0:(0,X.tZ)(Pe.m,null),onClick:function(){u(!l)}},"Revenir aux \xe9v\xe9nements de cette semaine")))):null},Ie=function(e){var t=e.selectedCategory,n=(0,s.Z)(e,["selectedCategory"]),r="dark"===(0,f.useColorMode)().colorMode;return(0,X.tZ)(he.Vp,(0,i.Z)({},n,{color:"white",bgColor:"transparent"===re.WD[t].bgColor?r?"whiteAlpha.300":"blackAlpha.600":re.WD[t].bgColor}),re.WD[t].label)},Ae=n(49444),Te=function(e){var t=e.selectedCategories,n=e.setSelectedCategories,r=(0,s.Z)(e,["selectedCategories","setSelectedCategories"]),o="dark"===(0,f.useColorMode)().colorMode;return(0,X.tZ)(B.k,(0,i.Z)({flexWrap:"nowrap",overflowX:"auto"},r),Object.keys(re.WD).map((function(e){var r=parseInt(e);if(0===r)return null;var a=re.WD[r].bgColor,i=t.includes(r);return(0,X.tZ)(Ae.r,{key:"cat-"+e,variant:"no-underline",onClick:function(){n(t.includes(r)?t.filter((function(e){return e!==r})):t.concat([r]))}},(0,X.tZ)(he.Vp,{variant:i?"solid":"outline",color:o||i?"white":"black",bgColor:i?"transparent"===a?o?"whiteAlpha.300":"blackAlpha.600":a:void 0,mr:1,whiteSpace:"nowrap"},re.WD[r].label))})))};function Le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Fe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Le(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Le(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _e(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ze(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ze(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}function ze(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Re=function(e){e.eventsQuery;var t=e.org,n=e.orgQuery,r=e.isCreator,l=e.isSubscribed,k=e.isLogin,F=e.setIsLogin,_=(0,s.Z)(e,["eventsQuery","org","orgQuery","isCreator","isSubscribed","isLogin","setIsLogin"]),z=(0,P.useRouter)(),R=(0,q.k)(),U=R.data,V=R.loading,W=(0,f.useToast)({position:"top"}),B="dark"===(0,f.useColorMode)().colorMode,H=(0,ie.TL)(),Q=(0,h.default)(new Date,0),G=(0,J.gV)(),$=(0,u.Z)(G,2),K=$[0],ee=($[1],(0,J.VA)()),le=(0,u.Z)(ee,2),ue=le[0],se=(le[1],(0,Y.iO)()),ce=(0,u.Z)(se,2),fe=ce[0],de=(ce[1],(0,J.SO)()),ve=(0,N.useState)(!1),pe=ve[0],ge=ve[1],me=(0,N.useState)(!1),Ze=me[0],he=me[1],be=(0,N.useState)(null),ye=be[0],we=be[1],Oe=(0,N.useState)(null),Se=Oe[0],xe=Oe[1],De=(0,N.useState)({entity:null}),Ce=De[0],Me=De[1];(0,N.useEffect)((function(){if(Ce.entity){var e=_.events.find((function(e){return e._id===Ce.entity._id}));Me({entity:e||null})}}),[_.events]);var Ee=(0,N.useState)([]),je=Ee[0],Pe=Ee[1],Ae=je?je.length:0,Le=(0,N.useState)(!1),ze=Le[0],Re=Le[1],Ue=(0,N.useState)(!1),Ve=Ue[0],We=Ue[1],Be=null===t||void 0===t?void 0:t.orgSubscriptions.map((function(e){return e.orgs.filter((function(e){return e.orgId===(null===t||void 0===t?void 0:t._id)&&e.type===ae.NY.FOLLOWER})).length})).reduce((function(e,t){return e+t}),0),He={deleteEvent:K,editEvent:ue,editOrg:fe,eventHeader:_.eventHeader,isCreator:r,isDark:B,isLoading:pe,setIsLoading:ge,org:t,orgQuery:n,orgFollowersCount:Be,session:U,eventToForward:Se,setEventToForward:xe,notifyModalState:Ce,setNotifyModalState:Me,eventToShow:ye,setEventToShow:we,toast:W},Qe=(0,N.useMemo)((function(){var e=null,t=null,n=function(e){var t,n=[],o=[],a=[],i=_e(e);try{for(i.s();!(t=i.n()).done;){var u=t.value;if((!(u.eventCategory&&je.length>0)||je.includes(u.eventCategory))&&(u.eventCategory||!(je.length>0))&&(r||u.eventVisibility===re.Hk.PUBLIC||u.eventVisibility===re.Hk.SUBSCRIBERS&&(l||r))){var s=(0,b.default)(u.eventMinDate),c=(0,b.default)(u.eventMaxDate),f=(0,y.Z)({start:s,end:c}).hours,d=void 0===f?0:f;if(-1!==(0,w.Z)(Q,s)?-1!==(0,w.Z)((0,O.default)(Q,1),s)?a.push(Fe(Fe({},u),{},{eventMinDate:s,eventMaxDate:c})):o.push(Fe(Fe({},u),{},{eventMinDate:s,eventMaxDate:c})):n.push(Fe(Fe({},u),{},{eventMinDate:s,eventMaxDate:c})),u.otherDays){var v,p=_e(u.otherDays);try{for(p.s();!(v=p.n()).done;){var g=v.value,m=g.startDate?(0,b.default)(g.startDate):(0,S.Z)(s,g.dayNumber+1),Z=g.startDate?(0,x.default)((0,b.default)(g.startDate),d):(0,S.Z)(c,g.dayNumber+1);-1!==(0,w.Z)(Q,m)?-1!==(0,w.Z)((0,O.default)(Q,1),s)?a.push(Fe(Fe({},u),{},{eventMinDate:m,eventMaxDate:Z,repeat:g.dayNumber+1})):o.push(Fe(Fe({},u),{},{eventMinDate:m,eventMaxDate:Z,repeat:g.dayNumber+1})):n.push(Fe(Fe({},u),{},{eventMinDate:m,eventMaxDate:Z,repeat:g.dayNumber+1}))}}catch(N){p.e(N)}finally{p.f()}}if(u.repeat)for(var h=1;h<=u.repeat;h++)if(h%u.repeat===0){var D=(0,O.default)(s,h),C=(0,O.default)(c,h);if(-1!==(0,w.Z)((0,O.default)(Q,1),D)?a.push(Fe(Fe({},u),{},{eventMinDate:D,eventMaxDate:C})):-1!==(0,w.Z)(Q,D)?o.push(Fe(Fe({},u),{},{eventMinDate:D,eventMaxDate:C})):n.push(Fe(Fe({},u),{},{eventMinDate:D,eventMaxDate:C})),u.otherDays){var M,E=_e(u.otherDays);try{for(E.s();!(M=E.n()).done;){var k=M.value,j=k.startDate?(0,O.default)((0,b.default)(k.startDate),h):(0,S.Z)(D,k.dayNumber+1),P=k.startDate?(0,O.default)((0,x.default)((0,b.default)(k.startDate),d),h):(0,S.Z)(C,k.dayNumber+1);-1!==(0,w.Z)((0,O.default)(Q,1),j)?a.push(Fe(Fe({},u),{},{eventMinDate:j,eventMaxDate:P,repeat:k.dayNumber+1})):-1!==(0,w.Z)(Q,j)?o.push(Fe(Fe({},u),{},{eventMinDate:j,eventMaxDate:P,repeat:k.dayNumber+1})):n.push(Fe(Fe({},u),{},{eventMinDate:j,eventMaxDate:P,repeat:k.dayNumber+1}))}}catch(N){E.e(N)}finally{E.f()}}}}}}catch(N){i.e(N)}finally{i.f()}return{previousEvents:n,currentEvents:o,nextEvents:a}}(_.events),o=n.previousEvents,a=n.currentEvents,u=n.nextEvents;return(0,X.tZ)(N.Fragment,null,(0,X.tZ)(Ne,{previousEvents:o,showPreviousEvents:ze,setShowPreviousEvents:Re,currentEvents:a,nextEvents:u,showNextEvents:Ve,setShowNextEvents:We,mb:5}),(0,X.tZ)(Te,{selectedCategories:je,setSelectedCategories:Pe,mb:5}),ze&&(0,X.tZ)(d.xu,null,o.sort((function(e,t){return(0,D.Z)(e.eventMinDate,t.eventMinDate)})).map((function(t,n){var r=!1,a=t.eventMinDate;return!e||(0,C.Z)(e)<(0,C.Z)(a)?(r=!0,e=a):r=!1,(0,X.tZ)(v.r,{key:"event-"+n,templateRows:"auto auto 4fr auto",templateColumns:"1fr 6fr minmax(75px, 1fr)"},(0,X.tZ)(N.Fragment,null,r?_.eventHeader?_.eventHeader:(0,X.tZ)(I.Q1,{colSpan:3,borderTopRadius:0===n?"lg":void 0},(0,X.tZ)(p.X,{size:"sm",py:3},(0,M.default)(a,"cccc d MMMM",{locale:E.Z}))):(0,X.tZ)(I.P4,{colSpan:3},(0,X.tZ)(I.LZ,{borderWidth:1})),(0,X.tZ)(ke,(0,i.Z)({},He,{event:t,index:n,length:o.length}))))}))),!ze&&!Ve&&(0,X.tZ)(N.Fragment,null,a.length>0?a.sort((function(e,t){return(0,D.Z)(e.eventMinDate,t.eventMinDate)})).map((function(e,n){var r=!1,o=e.eventMinDate;return!t||(0,C.Z)(t)<(0,C.Z)(o)?(r=!0,t=o):r=!1,(0,X.tZ)(v.r,{key:"event-"+n,templateRows:"auto auto 4fr auto",templateColumns:"1fr 6fr minmax(75px, 1fr)"},(0,X.tZ)(N.Fragment,null,r?_.eventHeader?_.eventHeader:(0,X.tZ)(I.Q1,{colSpan:3,borderTopRadius:0===n?"lg":void 0},(0,X.tZ)(p.X,{size:"sm",py:3},(0,M.default)(o,"cccc d MMMM",{locale:E.Z}))):(0,X.tZ)(I.P4,{colSpan:3},(0,X.tZ)(I.LZ,{borderWidth:1})),(0,X.tZ)(ke,(0,i.Z)({},He,{event:e,index:n,length:a.length}))))})):(0,X.tZ)(g.bZ,{status:"info"},(0,X.tZ)(g.zM,null),"Aucun \xe9v\xe9nement"," ",Array.isArray(je)&&1===Ae?(0,X.tZ)(N.Fragment,null,"de la cat\xe9gorie",(0,X.tZ)(Ie,{selectedCategory:je[0],mx:1})):Ae>1?(0,X.tZ)(N.Fragment,null,"dans les cat\xe9gories",je.map((function(e,t){return(0,X.tZ)(Ie,{selectedCategory:je[t],mx:1})}))):""," ","pr\xe9vu",o.length>0||u.length>0?" cette semaine.":".")),Ve&&(0,X.tZ)(d.xu,null,u.sort((function(e,t){return(0,D.Z)(e.eventMinDate,t.eventMinDate)})).map((function(t,n){var r=!1,o=t.eventMinDate;return!e||(0,C.Z)(e)<(0,C.Z)(o)?(r=!0,e=o):r=!1,(0,X.tZ)(v.r,{key:"event-"+n,templateRows:"auto auto 4fr auto",templateColumns:"1fr 6fr minmax(75px, 1fr)"},(0,X.tZ)(N.Fragment,null,r?_.eventHeader?_.eventHeader:(0,X.tZ)(I.Q1,{colSpan:3,borderTopRadius:0===n?"lg":void 0},(0,X.tZ)(p.X,{size:"sm",py:3},(0,M.default)(o,"cccc d MMMM",{locale:E.Z}))):(0,X.tZ)(I.P4,{colSpan:3},(0,X.tZ)(I.LZ,{borderWidth:1})),(0,X.tZ)(ke,(0,i.Z)({},He,{event:t,index:n,length:u.length}))))}))),(ze&&o.length>0||Ve||a.length>0)&&(0,X.tZ)(Ne,{previousEvents:o,showPreviousEvents:ze,setShowPreviousEvents:Re,currentEvents:a,nextEvents:u,showNextEvents:Ve,setShowNextEvents:We,mt:3}))}),[_.events,U,pe,ze,Ve,je]);return(0,X.tZ)("div",null,t&&(0,X.tZ)(N.Fragment,null,(0,X.tZ)(m.z,{colorScheme:"teal",leftIcon:(0,X.tZ)(c.d,null),mb:5,onClick:function(){V||(U?t?r||l?he(!0):W({status:"error",title:"Vous devez \xeatre adh\xe9rent ".concat((0,oe.rY)(t.orgType)," pour ajouter un \xe9v\xe9nement")}):he(!0):F&&k&&F(k+1))},"data-cy":"addEvent"},"Ajouter un \xe9v\xe9nement"),U&&Ze&&(0,X.tZ)(L.Q,{session:U,initialEventOrgs:[t],onCancel:function(){return he(!1)},onSubmit:function(){var e=(0,a.Z)(o().mark((function e(n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t&&H((0,ne.E2)()),e.next=3,z.push("/".concat(n),"/".concat(n),{shallow:!0});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onClose:function(){return he(!1)}})),Qe,ye&&(0,X.tZ)(A.n,{onClose:function(){we(null)},header:(0,X.tZ)(I.rU,{href:"/".concat(ye.eventUrl),size:"larger",className:"rainbow-text"},ye.eventName)},ye.eventDescription&&ye.eventDescription.length>0&&"<p><br></p>"!==ye.eventDescription?(0,X.tZ)("div",{className:"ql-editor"},(0,X.tZ)("div",{dangerouslySetInnerHTML:{__html:j().sanitize(ye.eventDescription)}})):(0,X.tZ)(Z.x,{fontStyle:"italic"},"Aucune description.")),Se&&(0,X.tZ)(te,{event:Se,onCancel:function(){xe(null)},onClose:function(){xe(null)},onSubmit:function(){xe(null)}}),(0,X.tZ)(T.i,{event:Ce.entity||void 0,org:t,query:n,mutation:de,setModalState:Me,modalState:Ce}))}},35011:function(e,t,n){"use strict";n.d(t,{n:function(){return l}});var r=n(38347),o=(n(67294),n(74860)),a=n(69822),i=n(70917),l=function(e){var t=e.closeOnOverlayClick,n=(0,r.Z)(e,["closeOnOverlayClick"]),l=(0,o.q)({defaultIsOpen:!0}),u=l.isOpen,s=(l.onOpen,l.onClose);return(0,i.tZ)(a.u_,{isOpen:u,onClose:function(){n.onClose&&n.onClose(),s()},closeOnOverlayClick:t},(0,i.tZ)(a.ZA,null,(0,i.tZ)(a.hz,null,(0,i.tZ)(a.xB,{px:3,pt:1},n.header),(0,i.tZ)(a.ol,null),(0,i.tZ)(a.fe,{px:3,pt:0},n.children))))}},48739:function(e,t,n){"use strict";n.d(t,{i:function(){return x}});var r=n(809),o=n.n(r),a=n(26265),i=n(92447),l=n(64121),u=n(40980),s=n(69822),c=n(27302),f=n(48017),d=n(83346),v=n(35528),p=(n(67294),n(97877)),g=n(17823),m=n(49759),Z=n(18716),h=n(1609),b=n(70917);function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var O=function(e){return void 0!==e.eventUrl},S=function(e){return void 0!==e.topicName},x=function(e){var t=e.event,n=e.org,r=e.query,y=e.mutation,x=e.setModalState,D=e.modalState,C=(0,u.useToast)({position:"top"}),M=(0,l.Z)(y,2),E=M[0],k=M[1],j=D.entity;if(!n&&!t||!j||!O(j)&&!S(j))return null;var P,N,I=n?n.orgName:t?t.eventName:"",A=n?n.orgSubscriptions:t?t.eventSubscriptions:[],T="",L="eventUrl",F="",_="l'\xe9v\xe9nement",z={orgIds:n?[n._id]:void 0},R=0;S(j)?(T=j._id,L="topicId",F=j.topicName,_="la discussion",z={org:n,event:t},A=A.filter((function(e){return void 0===e.phone})),j.topicNotified&&(R=(P=j.topicNotified).length)):O(j)&&(T=j.eventUrl,F=j.eventName,A=A.filter((function(e){return n&&e.orgs.find((function(e){return e.orgId===n._id&&e.type===Z.NY.FOLLOWER}))})),j.eventNotified&&(R=(N=j.eventNotified).length));var U=function(){var e=(0,i.Z)(o().mark((function e(){var t,n,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E((t={},(0,a.Z)(t,L,T),(0,a.Z)(t,"payload",z),t)).unwrap();case 2:n=e.sent,i=n.emailList,(0,h.t)(i)?(C({status:"success",title:"".concat(i.length," abonn\xe9s invit\xe9s !")}),r.refetch()):C({status:"warning",title:"Aucun abonn\xe9 invit\xe9"}),x(w(w({},D),{},{entity:null}));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,b.tZ)(s.u_,{isOpen:!0,onClose:function(){return x(w(w({},D),{},{entity:null}))}},(0,b.tZ)(s.ZA,null,(0,b.tZ)(s.hz,null,(0,b.tZ)(s.xB,null,S(j)?"Notifications":"Invitations"),(0,b.tZ)(s.ol,null),(0,b.tZ)(s.fe,null,(0,b.tZ)(c.bZ,{status:"info",flexDirection:"row"},(0,b.tZ)(c.zM,null),(0,b.tZ)(f.xu,null,"Ci-dessous la liste des abonn\xe9s"," ",n?(0,m.rY)(n.orgType):""," ",(0,b.tZ)("b",null,I)," \xe0"," ",S(j)?"notifier de ":"inviter \xe0 ",_," ",(0,b.tZ)("b",null,F),".")),(0,b.tZ)(f.xu,{overflowX:"auto"},(0,b.tZ)(d.iA,null,(0,b.tZ)(d.p3,null,A.map((function(e){var t="object"===typeof e.user?e.user.email||"":e.email||"",n=e.phone||null;return O(j)&&N.find((function(e){var r=e.email,o=e.phone;return r===t||o===n}))||S(j)&&P.find((function(e){return e.email===t}))?{email:t,phone:n,status:g.Sk.PENDING}:{email:t,phone:n,status:g.Sk.NOK}})).map((function(e){return(0,b.tZ)(d.Tr,{key:e.phone||e.email},(0,b.tZ)(d.Td,null,e.phone||e.email),(0,b.tZ)(d.Td,null,e.status===g.Sk.PENDING?(0,b.tZ)(v.Vp,{colorScheme:"green"},S(j)?"Notifi\xe9":"Invit\xe9"):(0,b.tZ)(p.rU,{onClick:(0,i.Z)(o().mark((function t(){var n,i,l;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,E((n={},(0,a.Z)(n,L,T),(0,a.Z)(n,"payload",w(w({},z),{},{email:e.email})),n)).unwrap();case 2:i=t.sent,l=i.emailList,(0,h.t)(l)?(C({status:"success",title:"Une ".concat(S(j)?"notification":"invitation"," a \xe9t\xe9 envoy\xe9e \xe0 ").concat(e.email," !")}),r.refetch()):C({status:"warning",title:"Aucun abonn\xe9 ".concat(S(j)?"notifi\xe9":"invit\xe9")});case 5:case"end":return t.stop()}}),t)})))},(0,b.tZ)(v.Vp,{colorScheme:"red"},S(j)?"Notifier":"Inviter"))))}))))),(0,b.tZ)(p.zx,{mt:3,colorScheme:"green",isLoading:k.isLoading,onClick:U},"Envoyer ",A.length-R," ",S(j)?"notifications":"invitations")))))}}}]);